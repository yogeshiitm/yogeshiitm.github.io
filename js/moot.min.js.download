/*

  Muut v1.16.31 (beta) | Apr 21, 2019

  "Real-time commenting or forums right on your site."

  (c) 2019 Muut Inc | muut.com

*/
!function(e){var t;loadMessaging=function(e){t||(jQuery("head").append(jQuery("<link/>",{href:"https://cdn.muut.com/1.16.31/muut-messaging.css",rel:"stylesheet",type:"text/css"})),jQuery.getScript("https://cdn.muut.com/1.16.31/muut-messaging.min.js",function(){muut.messaging()}),t=!0)},function(t){if("undefined"!=typeof jQuery){var o=jQuery().jquery.split(".");return Number(o[0])>1||Number(o[1])>6?t(jQuery):jQuery(".moot, .muut").text("Muut requires jQuery 1.7+")}e.write("<style>a.moot { display: none }</style>");var n=e.createElement("script");n.onload=n.onreadystatechange=function(){var e=n.readyState;(void 0===e||/complete|loaded/.test(e))&&t(jQuery)},n.src="//code.jquery.com/jquery.min.js";var a=e.getElementsByTagName("head")[0];a.insertBefore(n,a.firstChild)}(function(e){var t=e(".muut-messaging, .muut-messaging-button");e(".moot, .muut").add(t)[0]&&!e("link[href*='/moot.css']")[0]&&e("head").append(e("<link/>",{href:"https://cdn.muut.com/1.16.31/moot.css",rel:"stylesheet",type:"text/css"})),t[0]&&!e("link[href*='/muut-messaging.css']")[0]&&loadMessaging(t.eq(0).data("forumname")),function(e,t){"use strict";function o(e,o){var n={},a=[].slice;return e=e||{},t.extend(e,{on:function(o,a,i){if(o=o.split(" "),t.isFunction(a)&&(i=a,a=0),t.isFunction(i)){for(var r,l=0,s=o.length;l<s;l++)r=t.trim(o[l]),(n[r]=n[r]||[]).push(i),(s>1||"*"==o)&&(i.typed=!0);a&&(i.typed?i("inline",a):i(a))}return e},off:function(o,a){if("*"==o)return n={};o=o.split(" ");for(var i,r=0;r<o.length;r++)if(i=t.trim(o[r]),a){for(var l=n[i]||[],s=-1,c=0,u=l.length;c<u;c++)if(l[c]===a||l[c].listener===a){s=c;break}s>=0&&l.splice(s,1)}else n[i]=[];return e},one:function(o,n){return t.isFunction(n)&&(n.one=o,e.on(o,n)),e},emit:function(t){var o=a.call(arguments,1),i=n[t]||[],r=n["*"];r&&(i=i.concat(r));for(var l,s=0,c=i.length;s<c;++s)if((u=i[s])&&(l=u.typed?[t].concat(o):o,!1===u.apply(e,l)))return e;var u;for(s=0,c=i.length;s<c;++s)(u=i[s])&&u.one==t&&e.off(u.one,u);return e}}),t.each(o||[],function(o,n){e[n]=function(o){return t.isFunction(o)?e.on(n,o):e.emit.apply(e,[n].concat(a.call(arguments)))}}),e}window.RPC=function(e){"string"==typeof e&&(e={url:e}),navigator.userAgent.toLowerCase().split("googlebot")[1]&&(e.poll=!1);var n=e.session||{sessionId:localStorage["jsonrpc.session"]},a=o(this,["ready","close","reconnect"]),i=o({}),r=0,l=e.url;function s(e){if(e&&e.sessionId&&e.channelId){e.channelId!=n.channelId&&(m(),v()),n=t.extend({},e);try{localStorage.setItem("jsonrpc.session",e.sessionId)}catch(e){}}}a.onLine=navigator.onLine,void 0===a.onLine&&(a.onLine=!0),a.event=function(e,t){return i.on(e,t),a},a.session=function(){return t.extend({},n)},a.call=function(e){if(!a.onLine&&location.hostname.indexOf(".")>0)throw"offline mode";var i={method:e,session:n,jsonrpc:"2.1.0",transport:"ajax"},s=[].slice.call(arguments),c=s.slice(1,-1),u=s.slice(-1)[0];t.isFunction(u)||(void 0!==u&&(c=s.slice(1)),u=void 0),i.id="#"+ ++r,i.params=c,a.emit("send",e,i.params);var d=c&&c[0]&&c[0].files,m=o({},["done","fail","always"]);return m.done(function(e){u&&u(e.result)}),window.File&&d?(delete c[0].files,function(e,o,n){var a=new FormData;t.each(n,function(e,t){a.append(t.altname||t.name,t)}),a.append("jsonrpc",JSON.stringify(o));var i=new XMLHttpRequest;i.onload=function(t){var o=JSON.parse(t.target.response);e.emit("done",o).emit("always",t)},i.onerror=function(t){e.emit("fail",t).emit("always",t)},i.open("POST",l),i.send(a)}(m,i,d)):t.post(l,JSON.stringify(i).replace(/\?\?/g,"?&quest;"),function(t){a.emit("receive",t,e),t.error?m.fail(t.error):m.done(t),m.always(t)},"json"),m},a.on("receive",function(t,o){s(t.session),"init"==o&&(m(),s(t.session),a.time_offset=Date.now()-1e3*t.server_time,a.ready(t.result),n&&!1!==e.poll&&(window.EventSource?function e(){try{v()}catch(t){u++<2&&e()}}():w()))});var c,u=0;function d(e){c=Date.now(),e&&"ok"!=e&&"ping"!=e&&(a.emit("receive",e),i.emit.apply(null,e.params))}function m(){delete n.channelId,p&&1==p.readyState?(p.close(),a.emit("close")):f&&1==f.readyState&&(f.abort(),a.emit("close"))}void 0!==navigator.onLine&&setInterval(function(){var e=navigator.onLine;e!=a.onLine&&(a.emit(e?"online":"offline"),a.onLine=e),(c&&Date.now()-c)>3e5&&e&&(c=Date.now(),window.EventSource?(p&&p.close(),v()):f&&f.readyState>0&&f.readyState<4||w())},272);var p,f,h=0;function g(){for(var e=h;e==h;)e=1+Math.round(2*Math.random());return h=e,l.replace("client-api","events-"+e).replace("devapi","devevents")}function v(){n.channelId&&((p=new EventSource(g()+"/sse/"+n.sessionId+"/"+n.channelId)).onmessage=function(e){d(JSON.parse(e.data))},p.onerror=function(e){p.close(),setTimeout(v,2700)})}function w(){if(n.channelId){var e=t.extend({transport:"ajax"},n);f&&f.readyState>0&&f.readyState<4||(f=t.post(g()+"/poll/"+n.channelId,e,null,"json").done(function(e){d(e),e.error?f.abort():w()}).fail(function(e,t){try{f.abort()}catch(e){}setTimeout(w,2700)}))}}window.__reconnect=function(){m(),a.emit("reconnect")}};var n=1,a=26,i=36,r=38,l=700,s=128,c=72;function u(e,t,o){e/=o?l:2,e+=~~(e/t);for(var s=i-n,c=~~(s*a/2),u=0;e>c;u+=i)e=~~(e/s);return u+~~((i-n+1)*e/(e+r))}function d(e,t){for(var o=1114112,n=0,a=e.length;n<a;++n){var i=e[n];i>=t&&i<o&&(o=i)}return o}function m(e){return e+(e<26?97:22)}function p(e,t){for(var o,r,l=[],s=i,c=t;;s+=i){var u=(o=s)<=(r=e)+n?n:o>=r+a?a:o-r;if(c<u){l.push(m(c));break}l.push(m(u+(c-u)%(i-u))),c=~~((c-u)/(i-u))}return l}var f=2.718,h=10*f;function g(e,o){return t.isFunction(e)&&e.apply(o,[].slice.call(arguments,2)),o}var v=e?require("url").parse:function(e){var t=document.createElement("a");t.href=e;var o=t.pathname;return"/"!=o[0]&&(o="/"+o),{href:e,pathname:o,port:1*t.port||"",hostname:t.hostname,hash:t.hash,search:t.search,protocol:t.protocol}};function w(e){return e.indexOf("@")<0?e.replace(":","#"):e}function _(e){return e?e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;"):""}function y(e,o){e=t.trim(e.toLowerCase()),o||(e=e.slice(0,h)),e=e.replace(/&quest;/g,"");return t.each({a:/[áàâãªäå]/g,o:/[òóôõºöø]/g,e:/[éèê]/g,i:/[íìîı]/g,u:/[úùûü]/g,c:/[ç]/g,n:/[ñ]/g,"-":/[_\s]+/g},function(t,o){e=e.replace(o,t)}),e=function(e){for(var o,n,a=[],i=[],r=0,l=(e=t.map(e.split(""),function(e){return e.charCodeAt(0)})).length;r<l;++r)(v=e[r])<128?a.push(v):i.push(v);(o=n=a.length)&&a.push(45);var m=s,f=c,h=0;for(l=e.length;n<l;++m,++h){var g=d(i,m);for(h+=(g-m)*(n+1),m=g,r=0;r<l;++r){var v;(v=e[r])<m?++h:v==m&&(a=a.concat(p(f,h)),f=u(h,n+1,o==n),h=0,n++)}}return String.fromCharCode.apply(String,a)}(e),o||(e=e.slice(0,h)),(e=e.replace(/[^a-z0-9-]/g,"").replace(/^-|-$/g,"").replace(/\-{2,}/g,"-"))||(""+Math.random()).slice(10)}x.urlify=y;var b,k={};function x(e,n){if(void 0===e||"number"==typeof e)return b;if(t.isFunction(e)&&(n=e,e="ready"),"string"==typeof e)if(-1!=e.indexOf("/"))e={url:e};else if(t.isFunction(n))return(k[e]=k[e]||[]).push(n);if(t.isPlainObject(e)){e=t.extend({api_url:"https://client-api.muut.com"},e),"object"!=typeof console&&(e.debug=0);var a=new function(e){e.url.split("//")[1]||(e.url="//muut.com/"+e.url);var n,a=o(this),i=function(e,t){var o=(e=(e=e.replace("/i/","/").replace("/moot.it/","/client-api.muut.com/").replace("/muut.com/","/client-api.muut.com/")).replace(".com//",".com/")).split("/");o[o.length-1]=w(o.slice(-1)[0]);var n=(e=o.join("/")).split("#");n[1]&&(e=n[0]+"#"+y(n[1],t.skip_truncate)),"/"==(e=v(e)).href.slice(-1)&&(e.href=e.href.slice(0,-1),e.pathname=e.pathname.slice(0,-1));var a=e.href,i=a.split("/"),r="//"==a.slice(0,2)||a.indexOf("://")>0?a.slice(8).indexOf("/")+8:a.indexOf("/");e.path=a.slice(r),e.host=i[2];var l=t.api_url;return l&&!/moot.it|muut.com/.test(e.host)&&(l=v(l),e.orighost=e.host,e.host=l.hostname+(l.port?":"+l.port:""),e.protocol=l.protocol,e.hostname=l.hostname,e.port=l.port),e}(e.url,e),r=i.pathname.split("/"),l=!i.hash&&r.length>2,s=i.host;e.url=i,e.api_url=i.protocol+"//"+i.host,e.page_url=e.page_url||location.href.split("#")[0],t.extend(a,{version:"1.16.31",channel:null,name:r[1],path:"/"+r[1],is_commenting:!!i.hash,is_forum:!i.hash&&r.length<3,is_threaded:l,is_signed:!1,is_sso:!1,is_local:s.indexOf("local")>=0,is_dev:s.indexOf("dev")>=0,conf:function(){return e},canUse:function(e,o,n){var i=a.service||{},r=a.user.unlocked||[];return!!(i.trial_left>0||r.indexOf(e)>=0||i.level>=o||i.legacy&&"legacy"==n)||!!t.grep(i.products||[],function(e){return e=e.split("-")[0],(e=T[e]||e)===n})[0]},load:function(t,o){if(a.is_stub)throw Error("Forum not created");var i=e.query;t.path&&(i=t,t=t.path);var r=t.split("@")[1];if(e.profile_url&&r)return r=r.split(":"),location.href=e.profile_url.replace("%s",r[1]||r[0]),!1;(t=w(t))||(t=e.url.path);var l=new A(a,t,n);a.emit("before:load",l),i&&!i.path&&(i.path=l.path),l.query=i,n.call("moots",{path:i?void 0:decodeURI(l.path),expand_all:!e.show_title||e.expand_all,query:i},function(e){l.emit("load",e),a.one("load",o).emit("load",l)})},search:function(e,t){return a.load("/?"+encodeURI(e),t)},moveThread:function(e,t,o){return n.call("mootMove",{src:e,dst:t},o)},create:function(o,i){var r=x.fixTitle(o.title),s=r?r.length>30*f?"title:too_long":a.user.is_logged?a.user.banned?"user:banned":"":"user:not_logged":"title:missing";if(t.map(a.page,function(e){var t=e.seed;r==t.title&&a.user.path==t.user.path&&o.path==e.page.path&&(s="duplicate")}),s)throw new Error(s);t.extend(o,{title:r,key:y(r),body:x.fixBody(o.body,!0),pageLocation:e.page_url,path:o.path||a.page.path,watch:o.is_followed,_ajax:!0}),l&&t.extend(o,{pageTitle:e.channelName,mootTitle:e.mootTitle});var c=new C(a,o.path+"#"+o.key,t.extend(!0,{},o),n,!0);return a.page.emit("before:thread",c),a.emit("before:post",c.seed,!0),o.meta=c.seed.meta,n.call("createMoot",o,function(e){c.emit("key",e),c.seed.emit("key",e),a.page.one("moot",i).emit("moot",c,!0)})},createForum:function(e,o){var i=e.categories;return"string"==typeof i[0]&&(i=t.grep(i,function(e){return!!e}),e.categories=i=t.map(i,function(e){return{title:_(e.slice(0,40)),path:a.path+"/"+y(e)}})),n.call("createForum",e,function(){a.is_stub=!1,a.categories=i,a.emit("categories",i),g(o,a,i)})},getCategory:function(e){return e=e.split("#")[0],t.grep(a.categories,function(t){return t.path==e})[0]},setCategories:function(e,o){var i=[];return t.map(e,function(e){e.title=_(e.title.slice(0,164)),e.path||(e.path=y(e.title)),-1==e.path.indexOf(a.path)&&(e.path=a.path+"/"+e.path),e.unlisted||i.push(e)}),n.call("setCategories",{path:a.path,categories:i},function(){a.emit("categories",e),g(o,a,e)})},reload:function(e){return e&&(e.moots||e.user)?a.emit("reload",e):c("reload"),a},requestAccess:function(e,t){return n.call("accessRequest",{forumname:a.name,username:a.user.email,message:e},t)},log:function(e,o){o=t.extend({forum:a.path,page:a.page.path,user:a.user.email,version:a.version,url:location.href,ua:navigator.userAgent},o),n.call("log",{message:e,data:o})},destroy:function(){return a.emit("destroy",a).off("*"),n.close(),a.is_destroyed=!0,a}}),a.is_forum&&(e.show_title=!0);function c(o){var i="reload"==o,r=e.query,l=t.extend({},e,{version:a.version,path:r?void 0:w(a.page.path),query:r,currentForum:a.name,embedUrl:e.embedUrl||e.embedurl,skip_truncate:e.skip_truncate,pageLocation:e.page_url,expand_all:!e.show_title||e.expand_all,reload:i}),s=e.api||e.sso;if(s&&s.key){l.api=s,a.is_signed=!0;try{var c=atob(s.message),u=JSON.parse(c);a.is_sso=!!u.user,a.is_avatar_provided=u.user&&!!u.user.avatar}catch(e){return console.error("Invalid Muut SSO: "+c,e),a.emit("error",{message:"invalid_message",app:a,unhashed:c,e:e})}}(e.sso||e.fedid)&&(a.is_sso=!0),n.call("init",l,function(e){a.emit(o,e),a.is_ready=!0,a.__rpc=n}).fail(function(e){var t=e[0];"string"==typeof e&&(t={message:e,app:a}),a.emit("error",t)})}function u(e){var o=e.user;return delete e.user,t.extend(a,e),o}a.on("before:init",function(r){n||(n=new RPC("https://"+i.host),a.channel=new function(e,n){var a=o(this),i=e.conf().debug;n.ready(function(){a.time_offset=n.time_offset}),n.event("moot",function(t,o){t.from_channel=o.from_channel=!0;var i=new C(e,t,o,n),r=i.path.split("#")[0],l=e.getCategory(t.path),s=l&&!l.unlisted,c=e.page;if(!1===e.conf().show_title&&(i.is_expanded=!0),a.emit("beforethread",i),!i.no_render&&"feed"!=c.type){var u=0===(r+"/").indexOf(c.path)&&"all"!=c.type;e.is_forum&&!i.is_own&&(s||u)&&a.emit("moot",i),(u||c.title==i.seed.user.displayname||"all"==c.type&&s)&&(e.is_forum||i.is_own||a.emit("moot",i),c.emit("moot",i,!0))}}).event("reply",function(t,o){var i=e.page.find(t);if(!i){if(e.is_commenting)return!1;if(e.is_threaded){if(t.split("#")[0]!=e.page.path)return!1}else if(!e.getCategory(t))return!1;i=new C(e,t,{},n)}o.from_channel=!0,o=new S(i,o,n),i.emit("reply",o),o.is_own||a.emit("reply",o)}).event("type",function(t,o){var n=e.getCategory(t);e.is_forum&&(e.page.path==t.split("#")[0]||n&&!n.unlisted)&&a.emit("type",o,t);var i=e.page.find(t);i&&i.emit("type",o)}).event("like unlike remove spam unspam update",function(t,o,n){var i=e.page.find(o);i&&i.seed&&(i=i.seed),i&&i.emit(t,n,!0),a.emit(t,i||o,n)}).event("error",function(e,t){i&&console.error(arguments),a.emit("error",e,t)}).event("enter leave away return",function(e,t,o){a.emit(e,t,o)}).event("banned message",function(t,o){e.user.emit(t,o)}).event("login",function(t){e.reload(t)}).event("join",function(t){e.user.emit("before:join",t)}).on("send",function(o,n,a){if(a&&"init"!=o){var i,r=t.now();t.each([3e3,5e3,8e3,12e3],function(n,l){setTimeout(function(){!i&&t.now()-r>l&&(0==n&&e.emit("waiting",o,a),a.emit("progress",n,l))},l)}),a.on("done fail",function(){i=1})}}).ready(function(){a.session=n.session()}).on("reconnect error online offline",function(t){"reconnect"==t?e.one("reload",function(){a.emit(t)}):a.emit(t)}),i&&n.on("send",function(e,t){console.log(">",e,t&&1==t.length?t[0]:t)}).on("receive",function(e){e&&console.log("<",e.result||e.params||e)})}(a,n),n.reconnect(a.reload),a.page=new A(a,e.page_path||i.path,n),e.path&&(a.is_forum||l&&e.path.split(/[:#]/)[1])&&(a.page=new A(a,e.path,n))),a.page.is_init=!0,e.page_url.split("file://")[1]&&(e.page_url="https://muut.com"+a.path),c("init")}).on("init",function(e){a.page.is_init=!0,e.admins=e.admins||[];var i=u(e);a.user=new function(e,n,a){var i=o(this),r=(e.path,0);n.new_count=n.new_count||{all:0,feed:0},n.email||delete n.email;function l(e){return e[0].toUpperCase()+e.slice(1)}t.extend(i,{img:q,app:e,toggleFollow:function(t,o,n){var i={pageLocation:e.conf().page_url,path:t};return a.call(o?"mootWatch":"mootUnwatch",i,n)},toggleNotifications:function(t,o){return a.call("userNotifications"+(t?"Disable":"Enable"),{forumname:e.name},function(){"function"==typeof o&&o()})},logout:function(t){return function(){if(!i.is_logged)throw Error("must be logged")}(),a.call("logout",{path:e.page.path,expand_all:!e.conf().show_title},function(e){i.emit("logout",i.path),g(t,i)})},join:function(e,t){if(i.is_logged)throw Error("already logged");return e.username=e.username.toLowerCase(),a.call("join",e,function(e){g(t,i)})},update:function(t,o){return t.forumname=e.name,a.call("userUpdate",t,function(){t.url||i.emit("update",t),g(o,i)})},isAvailable:function(e,t){return a.call("isAvailable",e,t)},unfollowAll:function(o){return a.call("forumUnwatch",e.path,function(){i.subscription_count=0,t.each(e.page,function(){this.is_followed=!1,this.emit("unfollow")})})},type:function(o,n,l){if(!i.is_logged||i.is_visible){var s=t.now();s-r>1e3*f&&(a.call("type",{path:n?n.path:e.page.path,size:o.length},l),r=s)}},hideToggle:function(t){return a.call("user"+(i.is_visible?"Hide":"Show"),function(){var o=i.is_visible=!i.is_visible;e.channel.emit(o?"enter":"leave",i),g(t,i,o)})}}),t.each(["email_confirm","account_confirm","password_reset","validationCode_send","resetCode_check"],function(t,o){var n=o.split("_");i[n[1]+l(n[0])]=function(t,o){return a.call(n[0]+l(n[1]),t,function(t){t&&t.moots&&e.reload(t),g(o,i,t)})}}),i.on("login logout",n,function(o,n){"logout"==o?n={new_count:{all:0,feed:0},username:"",displayname:"",img:q,banTime:0,path:"",email:0,is_admin:0,is_moderator:0,is_owner:0}:(n.username=(n.path||"").slice(1),n.is_owner=!!t.grep(e.admins,function(e){return e.username==n.username&&e.is_owner})[0]),t.extend(i,n),i.is_logged=!!n.path,t.map(["unverified","is_visible","is_online","is_admin","is_moderator"],function(e){i[e]=!!n[e]}),e.is_stub&&i.is_logged&&(n.is_admin=!0)}),i.on("update",function(e){delete e.email,t.extend(i,e)}).on("follow unfollow",function(e){i.subscription_count+="follow"==e?1:-1}).on("banned",function(e){i.banned=e}),e.on("load",function(e){i.emit("newcount",i.new_count),i.new_count[e.type]=0,"all"==e.type&&(i.new_count.feed=0)}),e.channel.on("moot reply",function(t,o){e.page.find(o.path)||(i.new_count.all++,i.emit("newcount",i.new_count))})}(a,i,n),a.is_stub=!e.moots,a.emit("ready",a,n),a.emit("before:load",a.page),a.page.emit("load",e.moots),a.emit("load",a.page),delete a.moots}).on("load",function(e){a.page=e}).on("reload",function(e){var t=u(e);a.page.emit("reload",e.moots),a.user.emit("login",t)}).on("categories",function(e){e&&(a.categories=e,a.is_stub=!1)})}(e);return t.isFunction(n)&&a.on("ready",n),!1!==e.ui&&t.each(k,function(e,o){t.each(o,function(){a.on(e,this)})}),a.emit("before:init",a),b=a,a}}e?module.exports=x:window.muut=window.moot=x;var T={designer:"branding",developer:"sso"};function j(e,o,n,a){var i=this,r=e.path,l=e.app.page,s=e.match_count>=0&&a;i.is_gap=!0,i.size=i.available=o,s&&(i.match_count=e.match_count,t.each(e.replies,function(){this.is_gap||i.match_count--})),i.more=function(a,s){if(!i.available)return g(s);var c=Math.min(i.available,Math.ceil(o/(o<10?1:o<27?2:4)),50),u=a?c:e.reply_count,d=a?1:c,m=a?0:e.replies.length-1;if(a)for(var p=0;p<e.replies.length&&(f=e.replies[p])!=i;p++)u+=f.is_gap?f.available:1,d+=f.is_gap?f.available:1,m++;else{var f;for(p=m;p>=0;p--){if((f=e.replies[p])==i){m++;break}u-=f.is_gap?f.available:1,m--}m<=0&&(m=1),d=u-d+1}var h={path:r,start:u,end:d};return i.match_count>0&&"search"==l.type&&(h.path+="?"+l.title,delete h.end),n.call("moreReplies",h,function(o){o=t.map(o,function(t,o){var a=t.reply_count;return i.available-=a||1,!a&&i.match_count&&i.match_count--,a?new j(e,a,n):new S(e,t,n)}),i.available<0&&(i.available=0),e.one("more",s).emit("more",o,m)})}}function C(e,n,a,i,r){var l,s=o(this),c=e.conf(),u=e.page;if("string"==typeof n){var d=n.split("#");n={page:e.getCategory(d[0])||{path:n,title:n},is_followed:a.is_followed,path:n}}function m(){var t=e.user;if(r)throw Error("Not saved");if(!t.is_logged)throw Error("not logged");if(t.banned)throw Error("user:banned")}function p(e){return t.extend(e,{mootTitle:c.mootTitle||c.channelName,pageTitle:c.channelName,pageLocation:c.page_url})}r&&(n.is_expanded=!0),t.extend(s,n),t.extend(s,{app:e,replies:[],relativePath:s.path.replace(e.path+"/","/"),reply_count:s.reply_count||0,time:s.time||t.now(),has_replied:!!n.has_replied,is_expanded:!!n.is_expanded,is_followed:n.is_followed||n.is_watched}),s.page=s.page||{},r||a.user||e.is_commenting||(s.is_commenting=!0,a.user={}),s.seed=a=new S(s,a,i,r),s.is_own=r||a.user&&a.user.path==e.user.path,t.extend(s,{is_loaded:s.is_expanded,reply:function(o,n){m();var a=t.trim(o.body);if(!t.trim(a))throw new Error("no content");if(l==a)throw new Error("duplicate");l=a,o.body=a=x.fixBody(a,!0),o.key=y(a.join(""));var r=new S(s,o,i,!0);return s.emit("before:reply",r),e.emit("before:post",r),o.meta=r.meta,o.path=s.seed.is_stub?u.path:s.path,p(o),o.watch=o.is_followed,o._ajax=!0,i.call("reply",o,function(e){r.emit("key",e),s.one("reply",n).emit("reply",r)})},posts:function(){return t.grep([s.seed].concat(s.replies||[]),function(e){return!e.is_gap})},find:function(e){if(e){if(s.seed.key==e)return s.seed;e.split("#")[1]||(e=s.path+"/"+e);for(var t=0,o=s.posts(),n=o.length;t<n;t++)if(o[t].path==e)return o[t]}},expand:function(e){return s.toggle(!0,e)},collapse:function(e){return s.toggle(!1,e)},load:function(t){var o=e.page,n=s.path+("search"==o.type?"?"+o.title:"user"==o.type?o.meta.user.path:"");return s.is_loaded?g(t,s):i.call("moot",n,function(e){s.one("load",t).emit("load",e).emit("expand")})},toggle:function(o,n){if(t.isFunction(o)&&(n=o,o=void 0),"boolean"!=typeof o&&(o=!s.is_expanded),o==s.is_expanded)return g(n,s);if(o&&!s.is_loaded)return s.load(n);var a=o?"expand":"collapse";function r(){return s.one(a,n).emit(a)}return e.user.is_logged?i.call(a+"Moot",s.path,r):r()},followToggle:function(e,o){if(m(),t.isFunction(e)&&(o=e,e=void 0),"boolean"!=typeof e&&(e=!s.is_followed),e==s.is_followed)return g(o,s,e);var n=s.path;return e&&(n=p({path:n})),i.call(e?"mootWatch":"mootUnwatch",n,function(){var t=e?"follow":"unfollow";s.is_followed=e,s.one(t,o).emit(t)})},retireToggle:function(e,t){return i.call(e?"mootRetire":"mootUnretire",s.path,function(){s.is_retired=e,t&&t()})}}),s.on("key",function(e){r=!1,s.path=s.page.path+"#"+e}).on("load",function(e){s.is_loaded=s.is_expanded=!0,s.reply_count=e.reply_count,s.seed=new S(s,e.seed,i)}).on("load",n,function(e){var o=0;s.match_count=e.match_count,t.each(e.replies||[],function(e,t){var n=t.reply_count;s.replies.push(n?new j(s,n,i):new S(s,t,i)),o+=n||1}),s.is_expanded&&s.reply_count>o&&s.replies.unshift(new j(s,s.reply_count-o,i,!0))}).on("reply",function(e){s.lastReply=t.now(),s.reply_count++,s.is_followed=e.is_followed,e.is_own&&(s.has_replied=!0),s.is_loaded&&s.replies.push(e)}).on("edit remove",function(e,o){if(l=null,o.is_seed)return u.emit("remove",s);s.replies=t.grep(s.replies,function(e){return e.path!=o.path}),s.reply_count--}).on("more",function(e,t){[].splice.apply(s.replies,[t,0].concat(e))}).on("expand collapse",function(e){s.is_expanded="e"==e[0]}).on("reload",function(o){o&&(s.reply_count=o.reply_count,s.has_replied=!!o.has_replied,s.is_followed=!!o.is_followed,s.is_expanded?t.map([o.seed].concat(o.replies),function(t){var o=s.find(t.key);o?o.emit("reload",t):s.lastReply<t.time&&(t.from_channel=!0,o=new S(s,t,i),s.emit("reply",o),e.channel.emit("reply",o))}):o.is_expanded&&s.emit("load",o))}),e.user.on("logout",function(){s.has_replied=!1,s.emit("reload")})}muut.evented=o;var q="//cloudinary-a.akamaihd.net/moot/image/upload/t_default-avatar/v1364433583/moot-default-avatar.jpg";function A(e,n,a){var i=o(this),r=muut.language,l=e.path;l&&n!=l&&n.slice(0,l.length+1)!=l+"/"&&(n=l+"/"+n),"/"==(n=n.replace("//","/").replace(/[<>]/g,"")).slice(-1)&&(n=n.slice(0,-1));var s=n.split("::");n=s[0],i.type=/\?/.test(n)?"search":/\/feed/.test(n)?"feed":n==l+"/spam"?"spam":/@/.test(n)?"user":2==n.split("/").length?"all":/[#:]/.test(n)?"moot":"page",t.extend(i,{app:e,path:n,relativePath:n.replace(l,"/").replace("//","/"),extra:s[1],find:function(e){if(e){e=e.replace(":","#");for(var t,o=0;o<i.length;o++){if((t=i[o]).path==e)return t;if(t=t.find(e))return t}}},more:function(t){if(i.available){i.emit("before:more");var o=e.conf(),n=!o.show_title||o.expand_all,r=i.query||o.query,l={path:r?void 0:decodeURI(i.path),query:r,start:i.length,expand_all:n,skip_truncate:o.skip_truncate};return a.call("moots",l,function(e){i.one("more",t).emit("more",e)})}},collapse:function(e){var o=t.grep(i,function(e){return e.is_expanded}),n=t.map(o,function(e){return e.path});return a.call("collapseMoot",n,function(){t.each(o,function(){this.emit("collapse",!0)}),g(e,i,o)})}}).on("load",function(o){if(e.is_stub)return!1;t.extend(i,o);var a=i.path.replace(e.path,"");if(a?"/feed"==a&&(i.title=r.feed):i.title=r.all,!i.title){var l=t.trim(n.replace(/[\/-]/g," "));l=l[0].toUpperCase()+l.slice(1),i.title=l}try{i.title=decodeURI(i.title)}catch(e){i.title=i.title}"user"==i.type&&(i.user=new I(e,{path:i.title})),i.available=o.size,delete i.entries,e.is_commenting&&(o.entries[0]||o.entries.push({seed:{user:e.user},is_expanded:!0,path:n}),o.entries[0].seed.is_stub=!0)}).on("load more",function(o,n){t.each(n.entries,function(t,o){var n=new C(e,o,o.seed,a);i.emit("moot",n)}),i.available-=n.entries.length}).on("moot",function(e,t){i[t?"unshift":"push"](e)}).on("remove",function(e){var o;t.each(i,function(t,n){if(n.path==e.path)return o=t,!1}),o>=0&&(i.splice(o,1),i.size--)}).on("reload",function(o){o&&t.map(o.entries,function(t){var o=i.find(t.path);t.from_channel=!0,o?o.emit("reload",t):i[0]&&i[0].lastReply<t.lastReply&&i.emit("moot",new C(e,t,t.seed,a),!0)})})}function S(e,n,a,i){var r=o(this),l=e.app,s=l.user,c=l.conf(),u=!!n.title,d=e.path+(n.title||n.is_stub?"":"/"+n.key);function m(){if(!s.is_logged)throw Error("not logged");if(i)throw Error("not saved")}i&&(n=t.extend({},n,{user:s})),n.body=n.body||[],u&&!c.show_title&&(n.body[0]=n.title+n.body[0]),n.user=new I(l,n.user),n.meta=n.meta||{public:{}},t.extend(r,n,{app:l,moot:e,path:d,relativePath:d.replace(l.path+"/","/"),key:n.key||d.split("#")[1],is_own:i||n.user.path==s.path,likes:0,is_expanded:!!n.body[1],is_loaded:!n.has_more||!!n.body[1],is_seed:u,is_new:!!n.from_channel||s.new_count.all>0&&n.is_new,is_liked:!!n.is_liked,like_count:n.like_count||0,time:n.time||t.now(),likeToggle:function(o,n){if(m(),t.isFunction(o)&&(n=o,o=void 0),void 0===o&&(o=!r.is_liked),o==r.is_liked)return g(n,r,s);var i=r.is_liked?"unlike":"like",l=d;return e.seed.is_stub&&o&&(l={pageLocation:c.page_url,mootTitle:c.mootTitle||c.channelName,pageTitle:c.channelName,path:d}),a.call(i,l,function(){r.one(i,n).emit(i,s),e.emit(i,r)})},like:function(e){return r.likeToggle(!0,e)},unlike:function(e){return r.likeToggle(!1,e)},setMeta:function(e,t){return m()&&a.call("setMeta",d,e,function(){r.one("meta",t).emit("meta",e)})},remove:function(e,t){var o=s.is_moderator;if(!o&&!r.editTimeLeft())throw new Error("No permission");return a.call("delete",{path:d,force:o},function(){t=t||"remove",r.one(t,e).emit(t)})},edit:function(e){return r.is_own&&r.remove(e,"edit")},editTimeLeft:function(){var o=60*f,n=o-(t.now()-r.time)/1e3,a=!e.replies.length||e.replies.slice(-1)[0]==r;return i?o:n<0||!r.is_own||r.like_count||!a?0:n},whoLikes:function(e){return r.likes?e.call(r,r.likes):a.call("whoLikes",d,function(t){r.likes=t||[],g(e,r,t)})},more:function(e){return r.is_loaded?g(e,r):a.call("more",d,function(t){r.one("more",e).emit("more",t)})},toggle:function(e,o){if(t.isFunction(e)&&(o=e,e=void 0),void 0===e&&(e=!r.is_expanded),e===r.is_expanded)return g(o,r);if(e&&!r.is_loaded)return r.more(o);var n=e?"expand":"collapse";function i(){return r.one(n,o).emit(n)}return s.is_logged?a.call(n+"Post",d,i):i()},expand:function(e){return r.toggle(!0,e)},collapse:function(e){return r.toggle(!1,e)}}).on("key",function(t){r.key=t,r.path=d=u?e.path:e.path+"/"+t,i=!1}).on("like",function(e){(e.is_logged||e.path==s.path)&&(r.is_liked=!0),r.likes&&r.likes.push(e),r.like_count++}).on("unlike",function(e){(e.is_logged||e.path==s.path)&&(r.is_liked=!1),r.likes&&(r.likes=t.grep(r.likes,function(e){return e.path!=s.path})),r.like_count--}).on("more",function(e){r.is_loaded=r.is_expanded=!0,r.body.push(e)}).on("expand collapse",function(e){r.is_expanded="expand"==e}).on("edit remove",function(t,o,n){e.emit(t,r,n)}).on("update",function(e){t.extend(r,e)}).on("spam unspam",r.spam_level,function(e,t){if(r.spam_level=t,"inline"!=e&&(r.flag=e),t>=1){var o=20*f;r.body[0]=(r.body[0]||"").replace(/\n/g," "),r.body[0].length>o&&(r.body[1]=r.body[0].slice(o)+(r.body[1]||""),r.body[0]=r.body[0].slice(0,o)),r.is_expanded=!1}}).on("reload",function(e){r.is_expanded=!!e.is_expanded,r.is_liked=!!e.is_liked,r.is_new=!!e.is_new,r.is_own=e.user&&e.user.path==s.path}),t.each(["spam","unspam"],function(e,t){r[t]=function(e){return m(),a.call(t,d,function(o){r.one(t,e).emit(t,o)})}}),l.user.on("logout",function(){r.emit("reload",{is_expanded:r.is_expanded,is_liked:!1,is_new:!1})})}function I(e,o){var n=this;t.extend(n,o),n.username=(n.path||"").slice(1);for(var a=0,i=e.admins||[];a<i.length;a++)"@"+i[a].username==n.path&&(n.is_admin=!0)}A.prototype=[],x(function(e,o){function n(t){for(var o=0,n=e.online;o<n.length;o++)if(n[o].path==t)return o;return-1}function a(t){var o=n(t);o>=0&&e.online.splice(o,1)}function i(e,t){return e.filter(function(e){var o;return t.filter(function(t){t.username==e.username&&(o=!0)}),!o})}e.users=e.users||{online:[]},e.anon_count=e.users.anon_count||0,e.online=t.map(e.users.online,function(t){return t.is_online=!0,new I(e,t)}),e.getUser=function(t){return e.online[n(t)]},e.channel.on("enter",function(t){t&&(t.is_online=!0,e.online.push(new I(e,t)))}).on("leave",function(e){e&&a(e.path)}).on("away return",function(t,o){o&&(o=e.getUser(o.path)),o&&(o.is_active="return"==t)}).on("enter leave away return",function(t,o,n){var i=e.user;n>=0?e.anon_count=n:i.is_logged&&(e.anon_count+=i.is_visible?-1:1,i.is_visible||a(i.path))}),e.user.on("login logout",function(t,o){var n="login"==t;n&&!this.is_visible||(e.anon_count+=n?-1:1,e.channel.emit(n?"enter":"leave",n?this:{path:o}))});var r=e.users.online;e.refreshOnlineUserList=function(){t.getJSON("https://rest-api.muut.com/v1/forum/"+e.name+"/online",function(t){var o=t.users;i(r,o).forEach(function(t){t.img=t.avatar,t.path="@"+t.username,e.channel.emit("leave",t)}),i(o,r).forEach(function(t){t.img=t.avatar,t.path="@"+t.username,e.channel.emit("enter",t)}),r=o})}});var O=400*f,E=40*f,L=26*f,M=/\[#(.+)\/#\]/g,D=/-{3,} *(\w*)/g;x.fixTitle=function(e){return e=t.trim(e).replace(M,"$1"),t.each(e.split(/\s+/g),function(t,o){o.length>L&&!/\/\//.test(o)&&-1==o.indexOf("[")&&(e=e.replace(o,o.slice(0,L)+" "+o.slice(L)))}),e},x.fixBody=function(e,t){if(e=x.fixTitle(e).replace(/\n{2,}/g,"\n\n"),!t)return[e];var o=e.slice(0,O),n=e.slice(o.length);n.length&&n.length<E&&(o=e.slice(0,O-E));var a=20+o.split(D).length/2,i=e.split("\n");return i.length>a&&(o=i.slice(0,a).join("\n").slice(0,O)),n=e.slice(o.length),o=[o],n&&o.push(n),o}}(!this.top,jQuery),function(e,t){"use strict";var o,n,a={account_overlay:'<d"account overlay"><a"close">x</a><d"upload"><a>{ l.click_change }</a> <i"face"/> <input type="file" name="img" size="1"></d><d"names"><d"h3"><strong/>&bull; <a"logout">{l.logout}</a></d><d"h2"/><p"status"><s>o</s><em/> &bull; <a/></p></d><br clear="all"><f><d"h3">{l.name}</d><s"error"/><input type="text" class="m-input" name="displayname" maxlength="50"><p"right">{l.nametip}</p></f><f><d"email-updated"><d"h3">{l.step}</d><p>{l.step1}</p></d><d"field email"><d"h3">{l.email}</d><s"error"/><input name="email" class="m-input" type="email" maxlength="100"><p"right">{l.emailtip}</p></d></f><div id="m-notification-settings"><p id="m-disable-notifications"><l><input type="checkbox"> {l.no_notify}</l></p><div id="m-follow"><p><l><input type="checkbox"> {l.watchall}</l></p><p id="m-unfollow-all"><s>e</s><em/> &bull; <a>{l.unwall}</a></p></d></d><p"acc-footer"><a"my-profile">{l.my_profile}</a> <a"password">{l.changepw}</a></p></d>',account:'<d"nav-account"><a"login">{l.login}</a> <a"me"><s"myname"/><em"down">5</em> @img;</a></d>',dialog:'<d"mask"><d"dialog"><d"dialog-head"><s"dialog-close">x</s><d"dialog-title"></d></d><d"dialog-body"></d><d"dialog-foot"><b></b></d></d></d>',addons:'<div id="m-addons"><d"h3">{l.addons}</d><d"links"><p"branding">{l.designer}</p><p"sso">{l.developer}</p></d></d><a"upgrade button"></a>',admin:'<d"h3 manage-title">{l.manage}</d><d"links"><p><a"nav-designer">{l.design}</a></p><p><a"nav-settings">{l.settings}</a></p><p><a"nav-acc" href="https://muut.com/account/" target="_zap">{l.myaccount}</a></p><p><a"nav-spam" href="{hash}/spam">{l.spam}</a></p></d><div id="m-plan"><d"h3 plan-desc">{ l.plan }</d><d"planlist"><em>MINI</em> <em>SMALL</em> <em>MEDIUM</em></d><a"yearly"><em>x</em> {l.save_with}!</a><div id="m-trial-left"><p><em"badge"/>{ l.trial_left }</p></d><a"upgrade button"></a></d><d"refer" id="m-referred"><d"h3">{ l.reward }</d><a href="https://muut.com/account/#{ name }" target="_zap">{ l.off33 }</a></d>',commenting:'<d"comment-head"><d"comment-meta"><d"seed"><a"action heart"><s>a</s><strong/></a> <a"like"/><a"follow"><s"icon">e</s><strong/></a></d><d"like_list"/>@account;</d><d"comment_count"/></d>@page; @logo;',error_message:'<d"error-message"><p>{error} <s"code">{code}</s></p>{info}</d>',error_minimal:'<d"error-message">{error}</d>',forum:'<d"mask" id="st-mask"></d><d"header"><d"wrap"><d"table"><d"navi" id="m-mainlinks"><a"nav-feed" href="{hash}/feed"><s>{l.feed}</s><em"newcount"/></a> <a"nav-all" href="{hash}/"><s>{l.all}</s><em"newcount"/></a> <a"nav-forums"><s>{l.channels}</s></a> <a"nav-online"><s>{l.online}</s><em/></a></d><d"subnavi"><d"search" id="m-search"><input type="text" name="q" placeholder="{l.search}"></d>@account;</d></d></d></d><d"wrap">@page;<d"sidebar"><d"forums-wrap"><d"forums-wrap-inner"><d"h3 forums-title">{l.channels}</d><d"forums links"/><d"custom links"/><d"admin-area"/></d></d></d>@logo;</d>',gallery:'<div id="m-gallery"><a"close">x</a><nav id="m-navi"/><div id="m-media"><img id="m-img"/><div/></d></d>',logo:'<div id="moot-logo" style="display: block !important"><a href="https://muut.com/" target="_new"><s"icon">m</s> <s"slogan">Muut</s></a></d>',mod:'<d"links"><p><a"nav-spam" href="{hash}/spam">{l.spam}</a></p></d>',navi:'<p><a href="{href}">{title}</a></p>',no_access:'<div id="m-request-access"><d"h3">{l.is_private}</d><b"login button">{l.login}</b> {l.or_join}</d>',not_exists:'<d"invalid-access"><h4>Oops, "{name}" community does not exist</h4><a"button" href="{www}/setup/">Setup now&hellip;</a></d>',online:'<d"users"><d"users-inner"><d"h3 users-title">{l.online}<em/></d><d"logged-users"/><d"anon-count"/></d></d>',page:'<p"message"/><d"page"><d"pagetitle"><div/></d><s"loading-text">{l.loading}</s><d"form create">@help;</d><p"collapse-all"><a><em"icon">u</em> {l.collapse}</a></p><d"list"/><b"more-moots button"/></d>',profile:'<div id="m-user-profile">@img;<d"col"><d"h3">{ user.displayname }</d><d"meta">{ user.path }</d><b"msg">Send a private message</b><div id="m-profile-actions"><b"ban">{l.ban}</b> <b"secondary mkadmin">{ l.mkadmin }</b> <b"secondary mkmod">{ l.mkmod }</b><d><a href="https://muut.com/account/#{ forumname }" target="_new">{ l.upgrade_link }</a> &nbsp;<s></s>&hellip;</d></d><s"badge" id="acl-badge"><s></s> <a"revoke icon">x</a></s><div id="m-banned"><s"badge">{l.banned} <a"unban">x</a></s><l"days"><input type="text" value="30">{l.days}</l><l"cb"><input type="checkbox">{l.forever}</l></d></d></d>',request_access:'<div id="m-request-access"><d"me"><d"name"><d>{user.displayname}</d>{user.path} &bull; <a"logout">{l.logout}</a></d>@img;</d><d"h3">{l.is_private}</d><d"sect"><p><t"input" placeholder="{l.owner_msg}"></t></p><p><b"button">{l.req_access}</b></p></d></d>',share:'<div id="m-share"><a id="m-share-fb">f</a><a id="m-share-tw">j</a><a id="m-quot">"</a><a id="m-link">1</a></d>',start:'<div id="mt-start"><d"h3">{ l.reserve }</d><d"tooltip tip"></d><f><input type="text" name="name" class="m-input" maxlength="40" autocomplete="off"> <b"button">{ l.start_btn }</b></f></d>',threaded:"@account; @page; @logo;",banned:'<p"msg ban-msg"><em>{l.ban_acc}</em> {l.ban_msg}</p>',browser:'<d"h2">Muut</d><a href="https://muut.com"><img src="//muut.com/common/img/old-client.png"/></a><p><a href="http://browsehappy.com/">{l.upgrade}</a> {l.upgrade2}</p>',event:'<d"entry" data-path="{path}">@face;<d"data"><d"meta"><r"name">{user.displayname}</r> <s"time" data-time="{time}" title="{fullTime}">{prettyTime}</s></d><a"link">{title}</a></d></d>',face:'<a"facelink" href="{hash}/{user.path}" data-href="{hash}/{user.path}" title="{user.displayname}">@img;</a>',growl:'<d"growl"><a"destroy">x</a><d"entries"/></d><s"growlicon">L</s>',img:'<i"face" src="{user.img}" title="{user.displayname}">',unverified:'<p"msg unverified"><em>{l.unver1}</em> {l.unver2}<br><a>{l.unver3}</a> ({email})</p>',big_ok:'<d"mask"><d"big_ok"><s"icon">C</s> <s"messag">{l.moved}</s></d></d>',body:'<d"body-wrap"><d"body"/><a"show-all"/><a"action like"/><a"action unspam">{l.unspam}</a></d>',create:'<d"input-wrap"><t"input-title" rows="1"></t><t"input-body" rows="1"></t></d><d"controls"><l"watch"><input type="checkbox" name="watch"> { l.watch }</l><s>{ l.post_in }:<S"select" name="channel"/><em/></s><button title="{l.enter}"/>@show_preview;</d>',help:'<a"show-help">?</a><d"help"><a"close">x</a><d"help-format"><d"help-bolded">*<s>{l.bold}</s>* ({l.single})</d><d"help-italics">_<s>{l.italics}</s>_</d><d>&gt; <s>{l.help3}</s></d><d"help-monospaced">`<s>{l.monospaced}</s>`</d><d>[<s>{l.title}</s>](<s>{l.link}</s>)</d></d><d"help-code"><d>&#45;&#45;&#45;</d>{l.help5}<d>&#45;&#45;&#45;</d><d>&#45;&#45;&#45; html</d>&lt;p&gt;{l.help6}&lt;/p&gt;<d>&#45;&#45;&#45;</d></d><d"help-quote"><r>{l.quote_help1}</r> {l.quote_help2}</d><d"help-post"><em>ctrl</em> + <em>&crarr;</em> <s>&nbsp; {l.help2}</s></d></d>',meta:'<d"meta"><s"name">{user.displayname}</s> <a"time" data-time="{time}" title="{fullTime}">{prettyTime}</a> <s"cat"/><s"spammed">{l.spam}</s> <s"actions"><s"reply_count"/><a"action heart"><s>a</s><strong/></a> <a"follow"><s"icon">e</s></a> <a"action edit" title="{l.edit}"><s"icon">i</s></a> <a"action retire" title="{l.retire_title}"><s"icon">@</s></a> <a"action spam" title="{l.mark}"><s"icon">!</s></a> <a"action move" title="{l.move}"><s"icon">W</s></a> <a"action remove" title="{l.removepost}"><s"icon">x</s></a></s></d><d"like_list"/>',moot:'<d"moot"><d"replies"/><d"form replyform">@help;<t"postinput" rows="1" placeholder="{l.reply}"></t><d"controls"><l"watch"><input type="checkbox" name="watch"> { l.watch }</l><button title="{l.enter}">{l.replybtn}</b> @show_preview;</d><d"writing"/><d"retired-desc">{l.retired_desc}</d></d></d>',more:'<d"head"/><d"get-replies"><a"to-head button" title="{l.show_old}"><em/></a><br><a"to-tail button" title="{l.show_more}"><em/></a></d><d"tail"/>',move_thread:'<d"mask prompt"><d"dialog move-dialog"><d"dialog-head"><d"dialog-title">{l.move}</d></d><d"dialog-body"><l><r"coll">{l.from}:</r> <s"curr-thread-cat"></s></l><l><r"coll">{l.to}:</r><S></S></l><d"custom-path"><r>{l.custom_path}:</r><br><input type="text" class="m-input"></d></d><d"dialog-foot"><b"secondary">{l.cancel}<b>{l.move}</b></b></d></d></d>',no_title:'<t"postinput" rows="1" placeholder="{l.comment}"></t><d"controls"><l"watch"><input type="checkbox" name="watch"> { l.watch }</l><button title="{l.enter}"/></d>',preview:'<d"preview expanded"><d"facelink"><i"face"> <s"typing"/></d><d"post closed"><s"preview-title">{l.preview}</s><d"meta"><s"name"/><s"time">{l.now}</s></d><d"title"/>@body;</d></d>',prompt:'<d"mask prompt"><d"dialog alarm remove-dialog"><d"dialog-head"><d"dialog-title"/></d><d"dialog-body"></d><d"dialog-foot"><b"secondary">{l.cancel}<b>{l.yes}</b></b></d></d></d>',reply:'<d"reply">@face;<d"post">@meta; @body;</d></d>',retire_dialog:'<d"mask"><d"dialog retire-dialog"><d"dialog-head"><d"dialog-title">{l.retire_title}</d></d><d"dialog-body">{l.retire_desc}</d><d"dialog-foot"><b"secondary">{l.cancel}<b>{l.retire}</b></b></d></d></d>',seed:'<d"seed">@face;<d"post">@meta;<d"title-wrap"><d"title"></d><a"menu icon">0</a></d>@body;</d></d>',show_preview:'<l"show-preview"><input type="checkbox" name="previewpost"> <em></em>{l.show_preview}</l>',unretire_dialog:'<d"mask"><d"dialog unretire-dialog"><d"dialog-head"><d"dialog-title">{l.unretire_title}</d></d><d"dialog-body">{l.unretire_desc}</d><d"dialog-foot"><b"secondary">{l.cancel}<b>{l.unretire}</b></b></d></d></d>',writing:'<d"facewrap">@img; <em"typing"/></d><s>{user.displayname} {l.writing}</s>'};o=t(document),n=[],o.on("keydown",function(e){if(27==e.which){var t=n.pop();t&&t.trigger("close")}}),t.fn.active2=function(e,a){"string"==typeof e&&(e={prefix:e});var i=e.prefix;e=t.extend({close:"."+i+"close",close_on_click:!0,body_class:!0,prefix:"is-"},e);var r=this,l=i+"active",s=e.trigger||t(),c=(""+Math.random()).slice(1);function u(d){r.add(s).toggleClass(l,d),e.body_class&&t("body").toggleClass(i+"overlaid",d),d?(n.push(r),a&&a(r,s),e.close_on_click&&o.on("mouseup"+c,function(e){t(e.target).closest(r.add(s))[0]||u(!1)})):o.off("mouseup"+c)}return s.click(function(e){u(!r.hasClass(l))}),r.on("open close",function(e){e.isDefaultPrevented()||(u("o"==e.type[0]),e.stopPropagation())}),e.close&&r.on("click",e.close,function(){r.trigger("close")}),r},t.fn.autogrow=function(e){var o="minHeight,maxHeight,fontSize,fontFamily,lineHeight,fontWeight,padding".split(",");return this.each(function(){e=e||0;var n,a=t(this),i=a.next(".jqt-shadow"),r=a.is("textarea");a.one("keydown",function(){i=t("<"+(r?"div":"span")+"/>").attr("class","jqt-shadow").insertAfter(a),t.each(o,function(e,t){i.css(t,a.css(t))}),i.css({position:"fixed",top:"-9999em"}),r&&i.width(a.width()),n=a.height()}).keydown(function(){setTimeout(function(){var t=a.val();i.html(t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(" ","&nbsp;"):"-"),r?a.height(t?i.height()+e:n):a.width(i.outerWidth())},1)})})},t.fn.mousemoved=function(e,o){e=e||"is-hover",o=o||3e3;var n,a=0,i=0;return"ontouchstart"in window?this.addClass(e):this.each(function(){var r=t(this);r.on("mouseenter mouseleave",function(l){if(!t(l.relatedTarget).data("skip-hover")){var s="mouseenter"==l.type;r.toggleClass(e,s),s?(r.on("mousemove.jqt",function(o){i-o.pageX&&(r.addClass(e),a=t.now(),i=o.pageX)}),n=setInterval(function(){t.now()-a>o&&(r.removeClass(e),a=t.now())},1e3)):(r.off("mousemove.jqt"),clearInterval(n))}})})};var i="placeholder"in document.createElement("input");t.fn.placeholder2=function(e){return e=e||"",i?this:this.each(function(){var o=t(this),n=t("<span/>",{class:e+"placeholder",text:o.attr("placeholder")});o.after(n).keyup(function(){o.parent().toggleClass(e+"filled",!!o.val())}),n.click(function(){o[0].focus()})})},t.fn.tooltip2=function(e){var o=e.prefix||"",n=o+"tooltip",a=o+"hovered",i=e.position;return"ontouchstart"in window?this:this.each(function(){var o,r,l,s,c=t(this);(o=t("."+n,c))[0]||(o=t("<span/>",{class:n}).appendTo(c)),o.text(c.attr("title")),c.removeAttr("title").bind("mouseenter.tip2 mouseleave.tip2",function(u){var d=/ee/.test(u.type);if(o=t("."+n,c),d){l=c.outerWidth(),r=o.outerWidth(),s=setTimeout(function(){c.addClass(a)},e.timeout||0);var m="topleft"==i?1:2,p="left"==i?{top:0,left:-r}:"right"==i?{top:"35%",left:l+5}:{top:-o.outerHeight(),left:-r/m+l/m};o.css(p)}else c.removeClass(a),clearTimeout(s)})})};var r=/(^|\n)[-`]{3,} *(\w*)/g,l=/<(\/?)([^3><]+)(>?)/g,s=/\[#([^\/]+)\/#\]/g,c={"<3":"a",":D":"D",":-D":"D",":d":"D",":-d":"D",":)":")",":-)":")",";)":";",";-)":";",":O":"O",":-O":"O",":o":"O",":-o":"O",":0":"O",":-0":"O",":*":"*",":-*":"*",":|":"|",":-|":"|",":(":"(",":-(":"(",":P":"P",":-P":"P",":p":"P",":-p":"P",":/":"/",":-/":"/",":'(":"'",":'-(":"'","8)":"8","8-)":"8",">:(":">",">:-(":">",">:O":"<",">:-O":"<",">:o":"<",">:-o":"<",">:0":"<",">:-0":"<"},u="";for(var d in c)u+=d.replace(/(\)|\||\*|\(|\/)/,"\\$1")+"|";function m(e){return e&&e.replace(u,function(e,t,o,n){return"8)"==o&&"\n"==t?t+o:"<i>"+t+c[o]+"</i>"})}function p(e,t){return e&&(e=e.replace(l,"&lt;$1$2$3"),t&&(e=e.replace(s,"<mark>$1</mark>"))),e}u=new RegExp("(^|\\s)("+u.slice(0,u.length-1)+")","g");var f=/\.{3,}/g,h=/\"([^\"]+)\"/g,g=/\s\'([^\']+)\'/g,v=/\*([^\*]+)\*/g,w=/`([^`]+)`/g,_=/_([^_\]]+)_/g,y=/-{2,}/g,b=/ - /g;function k(e){return e?e.replace(f,"&hellip;").replace(h,"&#8220;$1&#8221;").replace(g," &#8216;$1&#8217;").replace(y,"&mdash;").replace(b," &ndash; "):""}function x(e){return e=k(e).replace(_,"<em>$1</em>").replace(v,"<strong>$1</strong>"),e=m(e=e.replace(E,function(e,t,o){return o=H(o=o.replace(/<\/?em>/g,"_")).replace(/[\s\'\"]/g,""),t=H(t),/(data|script).?[:&]/i.test(o)?t:U(o,t)}).replace(D,function(e,t){if(t)return e;var o=e.split("&#82");return o[1]?U(o[0])+"&#82"+o[1]:U(e)}))}moot.format=function(e,o,n){var a=e.slice(0,o?2:1).join("").split(r),i=!0,l="";return t.each(a,function(e,o){if((e+1)%3==0)return o;if(e%3==0&&(i=!i),!(o=t.trim(o)))return"";if(i){return l+=hilite2(t.trim(o.replace(s,"<mark>$1</mark>")),"","m-")}var a,r=((o=function(e){if(!e)return"";var o="";return t.each(e.split(w),function(e,t){o+=e%2?"<samp>"+t+"</samp>":x(t)}),o}(o=p(o,n)))+"\n").split("\n");t.each(r,function(e,o){">"==(o=t.trim(o)).slice(0,1)?(a||(l+="<blockquote>"),o=t.trim(o.slice(1)),a=!0):a&&(l+="</blockquote>",a=!1),(o||0!=e&&e!=r.length-1)&&(o?t.browser.msie&&t.browser.version<9?l+=o:l+="<p>"+o+"</p>":l+="<p class=m-empty/>")})}),l};var T,j={a:"a",b:"button",c:"code",d:"div",e:"fieldset",f:"form",i:"img",j:"iframe",l:"label",p:"p",r:"strong",s:"span",S:"select",t:"textarea"};t.each(a,function(e,t){a[e]=t.replace(/<(\w{1,2})"([\w\- ]+)"([^>]*)>/g,function(e,t,o,n){return o="m-"+o.split(" ").join(" m-"),"<"+(j[t]||t)+' class="'+o+'"'+n+">"}).replace(/<(\/?)(\w)>/g,function(e,t,o){return"<"+t+j[o]+">"})});for(var C=0;C<2;C++)t.each(a,function(e,t){a[e]=t.replace(/\s*@(\w+);\s*/g,function(e,t){return a[t]})});function q(e,o){o=o||0;var n=t.now();muut()&&(o=muut().channel.time_offset),o=o||0,n-e<10&&(e-=o);var a=new Date(n-o),i=moot.language,r=(a-e)/1e3,l=Math.floor(r/86400),s=Math.ceil(l/7),c=l<=0&&(r<60&&i.now||r<3600&&Math.floor(r/60)+i.min||r<86400&&Math.floor(r/3600)+i.hour)||l<30&&l+i.day||s<10&&s+i.week;if(c)return c;var u=new Date(e),d=u.getFullYear();return T=T||i.months.split(","),u.getDate()+" "+T[u.getMonth()]+(d!=a.getFullYear()?" "+d:"")}function A(e){return(""+new Date(e)).split("GMT")[0]}muut.toTime=function(e){return{prettyTime:q(e),fullTime:A(e)}};var S={};function I(e,t){return(S[e]=S[e]||Function("_","return '"+e.replace(/\{([^\}]+)\}/g,"'+ (_.$1 === undefined ? '' : _.$1) +'")+"'"))(t)}function O(e,o){var n=t.extend({},o||{},{l:moot.language,hash:muut.prefix}),i=a[e];n.time&&t.extend(n,muut.toTime(n.time));try{return I(i,n)}catch(t){console.error(e,i,t,n)}}moot.render=I;var E=/\[([^\]]+)\]\(\s*([^\s]+)\s*\)/gi,L=/https?:\/\//,M=/<\/?em>/g,D=/https?:\/\/[^\s\"\']+(\')?/gi,F=/(jpe?g|png|gif)$/i,P=["facebook.com","wikipedia.org/wiki","twitter.com","github.com","google.com","vimeo.com","youtube.com/watch?v","youtu.be","d.pr","dropbox.com"];function U(e,o){if(o){var n=o.replace(M," ").split(L);o=n[1]||n[0]||e.replace(L,"")}if(e=(e=e.replace(/<\/?mark>/g,"").replace(M,"_")).replace("&mdash;","--"),F.test(e.split("?")[0])){var a="m-image",i=e.split("?")[0].split("/").slice(-1)[0];return e.split("flickr.com")[1]?a+=" m-flickr-link":e.split("dropbox.com")[1]&&(e=e.replace("www.dropbox","dl.dropbox"),a+=" m-dropbox-link"),i.length>27&&(i=i.slice(0,10)+"&hellip;"+i.slice(-18)),"<a class='"+a+"' href='"+e+"'>"+(o||i).replace(l," ")+"</a>"}var r=e,s="",c=(a="m-link",muut.prefix);"http"!=e.slice(0,4)||e.split(location.host)[1]?(a+=" m-local-link",(r=r.replace(new RegExp("https?://"+location.host),"").replace(location.pathname,"")).slice(0,c.length+1)==c+"/"&&(a+=" m-moot-link",e=r,r=r.slice(3))):(s="target='_new' ",r=r.split("://")[1],t.each(P,function(t,o){if(-1!=(t=e.indexOf(o)))return"google.com"==o?r=(r=r.split("q="))[1]?r[1].split("&")[0]:r[0]:(r=e.slice(t+o.length+1),/wikipedia/.test(o)?r=r.replace("_"," "):"d.pr"==o&&(a+=" m-image","+"!=e.slice(-1)?e+="+":r=r.slice(0,-1))),a+=" m-"+o.split(".")[0]+"-link'",!1})),s+="class='"+a+"'",r&&r.length>40&&("/"==r.slice(-1)&&(r=r.slice(0,r.length-1)),r=(r=r.split("/"))[1]?r[0]+"/&hellip;/"+r.slice(-1)[0].slice(-27):r[0].slice(0,27)+"&hellip;");var u=e.slice(-1);return("."==u||","==u||")"==u&&-1==e.indexOf("("))&&(e=e.slice(0,-1)),"<a "+s+" href='"+e+"'>"+(o||r)+"</a>"}if(moot("format",function(e){t(".m-link",e).each(function(){var e=t(this);if("m-link"==e.attr("class")){var o=e.attr("href").split("/").slice(0,3).join("/");e.removeAttr("class").ac("favlink").prepend(t("<img/>",{src:"//icon.muut.com/"+o}))}})}),!t.browser){var N=t.browser={},R=navigator.userAgent.toLowerCase(),W=/(chrome)[ \/]([\w.]+)/.exec(R)||/(webkit)[ \/]([\w.]+)/.exec(R)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(R)||/(msie) ([\w.]+)/.exec(R)||R.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(R)||[];W[1]&&(N[W[1]]=!0,N.version=W[2]||"0")}function $(e,t){var o=e.conf(),n=o.prefix+(t||e.page).relativePath.replace("#",":");location.href=o.login_url+(o.url_escape?escape(n):n)}function H(e){return e?e=(e=e.replace(/&+#/g,"")).replace(/&+\w{1,5};/g,"").replace(/[\<\>\"\']/g,""):""}function z(e,o,n){var a=window,i="left="+((a.screenX||a.screenLeft)+(t(a).outerWidth()-o)/2)+",top="+((a.screenY||a.screenTop)+50)+",status=0,scrollbars=0,menubar=0";a.open(e,"moot_popup",i+",width="+o+",height="+n).focus()}function B(e){e=e||0;Math.floor(e/3600);var t,o=Math.floor(e/60);return o+":"+(t=e-=60*o,(t=parseInt(t,10))>=10?t:"0"+t)}function K(e,o,n){e&&e.length&&t("html, body").animate({scrollTop:e.offset().top-(o||200)},400,function(){!1!==(n&&n())&&e.mootboost()})}window.atob=window.atob||function(e){var t,o,n,a={},i=0,r=0,l="",s=String.fromCharCode,c=e.length;for(t=0;t<64;t++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(o=0;o<c;o++)for(i=(i<<6)+a[e.charAt(o)],r+=6;r>=8;)((n=i>>>(r-=8)&255)||o<c-2)&&(l+=s(n));return l},t.each(["add","remove","toggle","has"],function(e,o){t.fn[o[0]+"c"]=function(e,t){return this[o+"Class"]("m-"+e.split(" ").join(" m-"),t)}}),t.fn.mootslide=function(e,o){return e=e||100*Q,this.each(function(){var n=t(this),a=n.css({opacity:0}).outerHeight();n.height(0).animate({height:a},e).animate({opacity:1,queue:!0},e,function(){n.css({height:"",opacity:""}),(o||t.noop)()})})},muut.openWindow=z,t.fn.mootboost=function(e){return this.each(function(){var o=t(this);o.ac("boosted"),setTimeout(function(){o.rc("boosted")},e||500*Q)})};var Q=2.718;function J(e,o){var n=e.app,a=n.conf(),i=e.seed,r=window.moot.language,l=t(O("moot",t.extend({},e,i))),c=t(".m-replies",l);function u(e){return t.trim(e.join("").replace(s,"$1"))}l.data("moot",e),e.root=l.mousemoved("moot-hover").tc("flat",!!e.is_commenting),l.prepend(X(i,!0));var d=t(".m-seed",l);function f(o){var n=t(".m-replies, .m-seed .m-body-wrap, .m-form",l);o?(l.ac("animating expanded").rc("collapsed"),n.mootslide(200,function(){l.rc("animating")})):n.slideUp(100,function(){l.rc("expanded").ac("collapsed"),t(this).css({display:""})}),e.is_expanded=o}function h(){var e;t(".m-seed, .m-reply:not(.m-preview)",l).each(function(){var o=t(this),n=t(".m-facelink",this).attr("href");e&&n&&o.tc("followup",e===n),e=n})}return e.is_expanded||l.ac("collapsed"),e.on("expand load",!0,function(){var o=t(".m-follow",d).tooltip2({prefix:"m-"}).click(function(){return o.ac("loading"),e.followToggle(),!1})}).on("follow unfollow expand reload reply",!0,function(o){var a=!!e.is_followed;t(".m-follow",d).rc("loading hovered").tc("followed",a).find(".m-tooltip").text(r[a?"unwatch":"watch"]),/follow/.test(o)&&n.user.emit(o)}),e.on("load",e.is_expanded,function(o){var r="load"==o||o.seed;if(l.ac("expanded").rc("loading collapsed"),r){var s=X(e.seed,!0);d.replaceWith(s),i.root=d=s}t.each(e.replies,function(e,o){c.append(o.is_gap?function e(o){var n=t(O("more")),a=n.eq(0),i=n.eq(2),r=n.eq(1),l=t("a",r).tooltip2({prefix:"m-",position:"right"}),s=t(".m-tooltip",l.eq(1)),c=t("em",l).text(o.available);return o.available>26&&(r.ac("big"),s.text(moot.language.show_new)),l.click(function(){var n=t(this).ac("loading"),l=n.hc("to-head"),u=l?a:i,d={};d[l?"paddingBottom":"paddingTop"]=75*Math.min(o.available,10),u.animate(d),o.more(l,function(a){n.rc("loading"),c.text(o.available),u.stop().css({padding:0}),l||a.reverse(),t.each(a,function(t,o){(o=o.is_gap?e(o):X(o)).is_gap||o.mootboost(),u[l?"append":"prepend"](o)}),o.available<10&&(r.rc("big"),s.text(moot.language.show_more)),o.available||r.remove()})}),n}(o):X(o))}),r&&(f(!0),h()),(n.skip_sharing||!1===a.share)&&t(".m-menu",d).text("7").attr("href",a.prefix+i.relativePath.replace("#",":"))}).on("collapse",function(e){e&&f(!1),t(".m-new_count",d).hide()}).on("edit",function(e){var o=e.is_seed?t(".m-create textarea",n.root):t("textarea",l);e.is_seed&&(o.eq(0).val(u([e.title])),l.remove()),o.last().val(u(e.body)),o.keydown().keyup(),o[0].select()}).on("before:reply",function(e){n.user.is_admin||t(".m-remove",l).remove(),X(e).appendTo(c),e.root.ac("created"),e.on("key",function(){setTimeout(function(){e.root.rc("created")},500)})}).on("reply",function(o){o.from_channel&&e.is_loaded&&(n.user.is_admin||t(".m-remove",l).remove(),X(o).appendTo(c).mootslide()),o.is_own&&t(".m-is-new",l).rc("is-new")}).on("type",function(o){var n=t("<em/>").ac("typing").appendTo(t(".m-actions:first",l)),a=t(".m-writing",l);e.is_expanded&&a.html(O("writing",{user:o})),setTimeout(function(){n.remove(),a.empty()},1e3*Q)}).on("*",!0,function(a){if("type"!=a){var s=e.reply_count,c=(e.new_count,(e.is_expanded?i.time:e.lastReply)||i.time);t(".m-reply_count",d).toggle(s>0).text(s).tc("has_replied",!!e.has_replied);n.is_commenting&&(s&&t(".m-comment_count",l).text(s+" "+r["comm_count_"+(s>1?"n":"1")]),l.tc("first-comment",!s),i.like_count||i.is_liked||t(".m-like",i.root).text(r.likepost));t(".m-time",d).text(q(c)).attr({title:A(c),"data-time":c}).tooltip2({prefix:"m-",timeout:500});t(".m-title",d).html(m(k(p(i.title,"search"==o.type)))),e.page&&n.is_forum&&t(".m-cat",d).html(r.in_forum+" <a>"+e.page.title+"</a>").find("a").click(function(){if(e.is_expanded)return n.load(e.page.path),!1}),h()}}),n.is_commenting||"moot"==o.type||l.on("click",function(o){var n=window.getSelection;if(!(n&&n().toString()||l.hc("loading"))){var a=e.is_loaded;if(!e.is_expanded)return e.expand(),a?f(!0):l.ac("loading"),!1;t(o.target).is(".m-title")&&(e.collapse(),a&&f(!1))}}),e.viewToggleExpand=f,l}function X(e,o){e.user.displayname=H(e.user.displayname);var n=e.app,a=moot.language,i=e.is_stub?t(".m-comment-head",n.root):t(O(o?"seed":"reply",e)),r=n.user,l=e.moot.match_count>=0;function s(e,o,a){var r=t(O("prompt")).appendTo(n.root).active2("m-").trigger("open"),l=t(".m-title, .m-body",i).text();l[140]&&(l=l.slice(0,140)+"&hellip;"),t(".m-dialog-body",r).html("&#8220;"+H(l)+"&#8221;"),t(".m-dialog-title",r).text(o),window!=window.parent&&(r.css({position:"absolute",height:t(document).outerHeight()}),t(".m-panel",r).css({marginTop:t(e.target).offset().top-50})),t("button:last",r).click(a),t("button",r).click(function(){r.trigger("close").remove()})}n.is_forum||t(".m-facelink",i).removeAttr("href"),e.uploads=oe(e.body.join("")),t(".m-post",i).data("post",e),t(".m-time",i).attr("href",n.conf().prefix+e.relativePath.replace("#",":")).tooltip2({prefix:"m-",timeout:500}),e.user.is_admin&&t(".m-name",i).after(t("<span/>",{text:a.admin}).ac("mod-badge")),e.root=i.mousemoved(),e.on("reload",!0,function(){i.tc("is-new",!!e.is_new)}),t(".m-body",i).on("render",function(){var o=t(this),i=o.parent(),r=t(".m-show-all",i),s=e.is_expanded;function c(t){o.html(moot.format(e.body,t,l)),i.tc("closed",!t).tc("opened",t),r.html((t?a.less:"")+"&hellip;"),n.emit("format",o,e)}o.html(moot.format(e.body,s,l)),n.emit("format",o,e),(e.has_more||e.body[1])&&(i.ac("expandable "+(s?"opened":"closed")),r.html((s?a.less:"")+"&hellip;").click(function(){e.is_loaded?c(!e.is_expanded):r.ac("loading"),e.toggle(!e.is_expanded)})),e.on("more",function(){r.rc("loading"),c(!0)})}).trigger("render"),t(".m-heart",i).each(function(){var o=t(this),l=t(".m-like",i),s=t(".m-like_list",i).active2("m-");function c(n,i){arguments.length||(n=e.like_count,i=!!e.is_liked);var r=n;i&&(r=--n?"+"+n:""),l.text(i?a.unlike:a.like),o.tc("has-likes",!i&&n>0).tc("is-liked",i).toggle(!!n||i),t("strong",o).text(n?r:"")}l.click(function(){if(r.is_logged&&!r.banned){var t=!e.is_liked;c(e.like_count+(t?1:-1),t),e.likeToggle()}}),e.on("like unlike reload",!0,function(e){c(),"inline"!=e&&o.mootboost()}),o.click(function(){o.ac("loading"),s.empty(),e.whoLikes(function(e){var a=o.rc("loading").offset();t.each(e,function(e){s.append(O(n.is_forum?"face":"img",{user:this}))}),s.trigger("open").css({opacity:0}),setTimeout(function(){var e=a.left,t=s.outerWidth()/2,n=a.left>t;n&&(e+=o.outerWidth()/4-t),s.tc("edged",!n).css({opacity:""}).offset({top:a.top-s.outerHeight()-o.outerHeight()/2,left:e},10)})})})}),t(".m-action[title]",i).tooltip2({prefix:"m-"});var c=e.is_seed&&(r.is_admin||r.is_moderator),u=!!e.moot.retired,d=t(".m-retire",i);function m(o){t(e.moot.root).tc("retired",o),t(".m-tooltip",d).text(c?a[o?"unretire_title":"retire_title"]:a.is_retired)}d.click(function(){if(c){t(this);var o=!u,a=t(O((o?"":"un")+"retire_dialog")).appendTo(n.root);t("button",a).one("click",function(){a.remove()}),t("button:last",a).one("click",function(){e.moot.retireToggle(o,function(){m(o),u=o})})}}),m(u),t(".m-move",i).toggle(c).click(function(){var o=t(O("move_thread")).appendTo(n.root),i=t(".m-custom-path",o),r=n.getCategory(e.moot.path);r&&t(".m-curr-thread-cat").text(r.title);var l=t("select",o).empty(),s=n.categories||[];t.each(s,function(e,o){var a=o.path.replace(n.path,"");a&&"/"!=a&&"/feed"!=a&&o.path!=(r&&r.path)&&l.append(t("<option/>",{value:o.path,text:o.title}))}),l.append('<option value="-">- '+a.custom_path1+" -</option>"),l.change(function(){i.toggle("-"==l.val())}),t("input",i).val(e.moot.relativePath.replace("#",":")),o.active2("m-").trigger("open"),t("button:first",o).one("click",function(){o.remove()}),t("button:last",o).off("click").click(function(){var r=l.val()+"#"+e.key;if("-"==l.val()){var s=t("input",i).val();if("/"!=s[0]||-1==s.indexOf(":"))return alert(a.invalid_path);s=s.split(":"),r=n.path+s[0]+"#"+muut.urlify(s[1])}o.remove(),n.moveThread(e.moot.path,r,function(){e.moot.root.remove();var o=t(O("big_ok")).appendTo(n.root);setTimeout(function(){o.remove()},1500)})})});t(".m-remove",i).click(function(t){s(t,a.rem_post,function(){i.ac("loading"),e.remove(function(){setTimeout(function(){i.remove()},400)})})});var p=t(".m-edit",i).click(function(){e.edit(),i.remove()}),f=e.editTimeLeft();if(f>0)var h=setInterval(function(){t(".m-tooltip",p).text(a.undo+" "+B(f--)),f<0&&(i.rc("editable"),clearInterval(h))},1e3);function g(){i.tc("editable",e.editTimeLeft()>0&&e.is_own)}function v(e){var o=t("<span/>",{text:a.thanks}).ac("thanks badge").insertBefore(e);setTimeout(function(){o.remove()},3e3)}e.on("reload like",!0,g),e.moot.on("reply",g);var w=t(".m-spam",i).click(function(t){s(t,a.is_spam,function(){e.spam(),v(w)})}),_=t(".m-unspam",i).click(function(){e.unspam(),v(_)});return e.on("spam unspam",e.spam_level,function(o,n){var a=n>=1;i.tc("is-spam",a),e.is_seed&&e.moot.root.tc("is-spam",a),a&&!i.hc("is-spam")&&t(".m-body",i).trigger("render")}).on("remove",function(e,t){t&&i.remove()}),r.on("login",!0,function(){var t=e.user.path==r.path;w.toggle(!t),e.spam_level&&_.toggle(r.is_logged&&(!t||r.is_admin)),e.user.is_admin&&w.toggle(e.spam_level>0)}),n.emit("post",e),i}moot("error",function(e){if(!e.app||!e.app.is_sso&&!e.app.is_signed)return!1;var o=e.app,n=o.conf(),a=n.api,i=n.url.path.replace("/",""),r=o.root||t("body");if(/signature/i.test(e.message))r.html(O("error_message",{error:"Invalid signature",code:a.signature,info:"<p>Please make sure the format of the string being hashed is correct.</p>"}));else if(/timestamp/i.test(e.message))o.is_initialized?r.html(O("error_minimal",{error:"<p>Connection timed out. Please refresh the page to reload.</p>"})):r.html(O("error_message",{error:"Invalid timestamp",code:a.timestamp,info:"<p>Please make sure the timestamp is recently generated.</p>"}));else if(/apikey/i.test(e.message))r.html(O("error_message",{error:"Invalid API key",code:a.key,info:"<p>Please make sure to copy the correct API key from your community settings.</p>"}));else if(/invalid_message/i.test(e.message)){var l="";e.unhashed&&(l='Unhashed message <span class="m-code">'+e.unhashed+"</span>"),r.html(O("error_message",{error:"Invalid message",code:a.message,info:l+"<p>"+e.e+"</p>"}))}else/not_allowed/i.test(e.message)&&r.html(O("error_message",{error:"Access denied on community ",code:i,info:"<p>Please make sure your community href is correct.</p>"}));throw new Error(e.message)}),moot(function(e){var o,n=e.root,a=e.conf(),i=moot.language;function r(){n.data("ready",!1),n.empty(),e.destroy(),n.muut(a)}e.is_initialized=!0;var l,s=e.failure_message;if(s)return n.html(t("<div/>").text(s).css({textAlign:"center",margin:"4em 0"}));if(e.is_stub){if("available"!=e.forumAvailable&&!e.access_only)return n.replaceWith("");if(e.access_only){var c=e.user.is_logged,u=t(O(c?"request_access":"no_access",{user:e.user}));return n.html(u).rc("app-loading"),c?(t("button",u).click(function(){var o=H(t("textarea",u).val());u.ac("loading"),e.requestAccess(o,function(){t(".m-sect",u.rc("loading")).text(i.req_sent)})}),t(".m-logout",u).click(function(){u.ac("loading"),e.user.logout()}),e.user.one("logout",r),!1):(t("a",u).click(function(){t(".m-login",u).trigger("click",{tab:1})}),e.user.one("login",r))}if(!/moot.it|muut.com/.test(location.host))return n.rc("app-loading").html(O("not_exists",{name:e.name,www:"https://muut.com"})),!1}function d(e){e&&window.pageYOffset+window.outerHeight<n.offset().top&&(e=null),n.tc("has-message","string"==typeof e),t(".m-message",n).text(e),e&&e.stack&&console.error(e.stack)}if(e.messaging_enabled&&!muut.messaging&&loadMessaging("https://client-api.muut.com/"+e.name),t.each(["forum","threaded","commenting"],function(t,o){e.user.displayname=H(e.user.displayname),e["is_"+o]&&n.html(O(o,{user:e.user})).addClass("is-"+o)}),e.is_threaded&&a.show_online&&n.prepend(O("online")),location.hash.split(a.prefix)[1]&&!a.widget&&e.on("load",function(o){var a="unread"==e.page.extra?t(".m-reply:last.m-is-new:first, .m-replies > :last",n):n;o.is_init&&a[0]&&t("html, body").animate({scrollTop:a.offset().top-30},300)}),setInterval(function(){t("[data-time]",n).each(function(){var e=t(this),o=e.data("time"),n=t("span",e);o&&e.html(q(o)+(n[0]?n[0].outerHTML:""))})},1e4*Q),e.on("error",d).on("waiting",function(e,t){t.on("progress",function(e,t){d(i.progress[e]),3==e&&(o=setTimeout(d,1e3))}).done(function(){clearTimeout(o),d()})}).on("destroy",function(){n.empty().data("ready",!1)}),e.channel.on("close",function(){o=setTimeout(function(){d(i.reconnect),setTimeout(d,15e3)},2700*Q)}).on("reconnect",function(){clearTimeout(o),d()}).on("type",function(e){e.img?e.displayname=H(e.displayname):(e.img="//i2.wp.com/cloudinary-a.akamaihd.net/moot/image/upload/t_d2-avatar/v1364433564/moot.jpg?ssl=1",e.displayname=i.someone)}),e.is_commenting&&(t(".m-create",n).remove(),n.on("click",'a[href^="'+a.prefix+'"]',function(e){e.preventDefault()})),window.onloadCallback=function(){l={},t("body").prepend('<div id="grecaptcha" class="g-recaptcha"></div>'),l.defaultCallBack=function(e){grecaptcha.reset(l.widgetId),l.callback(e)},l.widgetId=grecaptcha.render("grecaptcha",{sitekey:e.recaptcha_sitekey,callback:l.defaultCallBack,size:"invisible"}),e.recaptcha=l,e.messaging&&"function"==typeof e.messaging.trigger&&e.messaging.trigger("recaptcha-load",l)},e.recaptcha_sitekey){if(console.log("app.recaptcha_sitekey :",e.recaptcha_sitekey),!e.recaptcha_sitekey.length)throw new Error("No recaptcha sitekey provided.");t.getScript("https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit")}}),moot(function(e){var o=e.root,n=t(".m-list",o),a="created",i=t(".m-collapse-all a",o).click(function(){e.page.collapse()}),r=t(".m-more-moots",o).click(function(){e.page.more()});function l(){e.is_commenting||setTimeout(function(){var o=t.grep(e.page,function(e){return e.is_expanded});i.parent().tc("shown",o.length>0)},1)}e.is_commenting&&i.parent().remove(),e.on("before:load",function(i){r.hide(),i.on("load more",function(t){if(r.text(i.available).css("display",i.available>0?"block":"none"),l(),!e.is_commenting&&"load"==t){var n=i.find(i.path);n?K((n.seed||n).root,200):i.is_init||K(o,100,function(){return!1})}}).on("before:more more",function(e){r.tc("loading","more"!=e)}).on("before:thread",function(e){J(e,i).prependTo(n),e.root.ac(a)}).on("moot",function(o,r){if(o.root&&o.root.hc(a))setTimeout(function(){o.root.rc(a)},500*Q);else if(r){var s=J(o,i).prependTo(n);o.from_channel&&s.mootslide()}else J(o,i).appendTo(n);o.on("expand collapse",l);var c=o.page;"moot"==i.type&&c.title&&!e.is_commenting&&t("<a/>",{text:H(c.title)}).ac("back").appendTo(n).click(function(){e.load(c.path)}),e.emit("topic",o,r)}).on("remove",function(e){e.root.fadeOut(function(){e.root.remove()})})})}),moot(function(e,o){if(!e.is_commenting){var n,a=e.root,i=e.user,r=e.conf(),l=moot.language,s=t(".m-header",a),c=t(".m-page",a),u=t(".m-sidebar",a),d=(t(".m-navi",a),t(".m-nav-feed",a)),m=t(".m-forums-wrap",u),p=t(".m-forums",m),f=t(".m-forums-title",m),h=t(".m-custom",u),g=t(".m-nav-all",a),v=t(".m-list",a),w=t(".m-pagetitle div",a);if(a.on("click","a[target]",function(e){return window.open(this.href).opener=null,!1}),a.off("click.zoo").on("click.zoo",'a[href^="'+r.prefix+'"]',function(o){if(!e.is_forum&&t(o.target).hc("face"))return!1;var n=t(this);if(!(o.metaKey||o.ctrlKey||n.attr("target"))){var a=n.attr("href").slice(r.prefix.length);return"feed"!=a||i.is_logged?(n.ac("loading"),e.load(a),!1):(e.user.login(function(){n.click()}),!1)}}),m.active2({prefix:"m-",trigger:t(".m-nav-forums",s)},function(e,o){e.css({height:""});var n=o.offset(),a=n.top,i=o.height(),r=window.scrollY,l=t(window).height(),s=e.outerHeight()+5,c=Math.ceil(l-i-a-20+r),u=Math.min(c,s);e.offset({top:n.top+o.outerHeight()+10,left:n.left-(e.outerWidth()-o.outerWidth())/2}),e.css({height:u+"px"})}),i.on("login logout",!i.is_logged,function(){d.attr("title",i.is_logged?"":l.login1)}),e.html){h.html(e.html);var _,y=[],b=[];t("a",h).each(function(){var o=t(this),n=o.attr("href"),a=r.prefix;if(!n||n.slice(0,a.length+1)==a+"/"){var i=e.path+"/"+(n?n.slice(3):moot.urlify(o.text())),l={title:o.text(),path:i,href:k(i)},s=o.is(".unlisted, .non-category");s?l.unlisted=!0:y.push(l),o.replaceWith(O("navi",l)),delete l.href,i.split(/[:#]/)[1]||(s||e.getCategory(i)||(_=!0),p.add(f).remove(),b.push(l))}}),b[0]||(b=e.categories),y.length&&y.length!=e.categories.length&&(_=!0),i.is_admin&&_&&!1!==r.save_channels?e.setCategories(b):y[0]&&e.emit("categories",b),t(".moot-footer",h).remove().appendTo(u)}if(p[0]?e.on("categories",e.categories,function(o){o=o||e.categories,p.empty(),t.each(o||[],function(e,o){o=t.extend({},o,{href:k(o.path)});var n=t(O("navi",o)).appendTo(p);t("a",n).tc("has-new",!!o.has_new)})}):f.remove(),m.on("click",".m-links a",function(){m.trigger("close")}),e.on("before:load",function(o){v.empty().ac("loading"),a.attr("class",t.trim(a.attr("class").replace(/m-\w+page/,""))),a.rc(e.page.type+"page"),w.html(l.loading).css("display",""),t(".m-selected",a).rc("selected"),t("[href='"+k(o.path)+"']",a).add(c).ac("loading")}).on("load",function(e){var o=t("#m-search input",a),n=e.title;v.removeClass("m-loading"),a.addClass("m-"+e.type+"page"),w.text(n),t(".m-loading",a).removeClass("m-loading m-has-new"),t("[href='"+k(e.path)+"']",a).addClass("m-selected"),o.on("focus blur",function(e){o.closest(".m-subnavi").tc("focus","f"==e.type[0])}),"search"==e.type?(e.length?(e.old_query&&w.html(l.showing+" &ldquo;<strong>"+n+"</strong>&rdquo;<em>"+l.noresults+" &ldquo;"+e.old_query+"&rdquo;"),e.suggestion&&w.html("<strong>"+n+"</strong><em>"+l.mean+' <a href="'+r.prefix+"/?"+e.suggestion+'"">'+e.suggestion+"</a>?")):w.html(l.noresults+" &ldquo;<strong>"+H(n)+"</strong>&rdquo;"),o.val()!=w&&o.val(n).keyup()):o.val(""),e.size||"spam"!=e.type||w.append("<em>"+l.nospam+"</em>")}),i.on("newcount",function(e){x(d,e.feed),x(g,e.all),e.all||t(".m-has-new",u).rc("has-new")}),t("#m-search",s).each(function(){var o=t(this),n=t(":input",o).placeholder2("m-");n.keyup(function(o){if(13==o.which){var n=t.trim(this.value);n&&e.search(n)}}),t(".m-placeholder",o).click(function(){n.focus()})}),history.pushState&&!r.widget)e.on("load",function(e){var t=e.path,o=k(t.replace("#",":"));e.is_init||"/"!=t[0]||n||history.pushState(null,null,o)}),t(window).on("popstate",function(t){var o=unescape((location.href+location.hash).split(r.prefix+"/")[1]||"");(o||e.page.path!=e.path)&&(e.page.is_init||(n=!0,e.load(o,function(){n=!1})))})}function k(e){var t=e.split("@");return r.prefix+"/"+(t[1]?"@"+t[1]:e.split("/").slice(2).join("/"))}function x(e,o){t(".m-newcount",e).css({display:o>0?"inline-block":"none"}).text(o)}}),moot(function(e){var o=e.conf();if(!o.show_title){var n=t(".m-create",e.root).append(O("no_title")),a=t("textarea",n).autogrow(),i=t(":checkbox",n),r=moot.language,l=e.user,s=t("button",n);o.autowatch?i.parent().hide():i.prop("checked",o.autowatch_checked),Z(n,e),l.on("login logout",!0,function(){s.text(l.is_logged?r.post:r.login_and+" "+r.post.toLowerCase())}),a.on("focus away",function(e){n.tc("focused","f"==e.type[0]||!!a.val())}),s.click(function(o){o.preventDefault();var n=t.trim(a.val()),c=n.slice(0,27),u={title:c,body:n.slice(c.length),is_followed:i.is(":checked")},d=oe(n);n&&l.is_logged&&(a.val("").trigger("away").trigger("keydown").blur(),d[0]&&(u.files=d),s.prop("disabled",!0),e.create(u,function(){s.prop("disabled",!1)}).fail(function(o){t(".m-created",e.root).remove(),a.val(n).focus(),root.prepend(t("<div/>").ac("err tooltip").text(r.error)),u.error=o,e.log("error comment:failed",u)}))})}});var Y=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);moot(function(e){var o,n=e.user,a=e.conf(),i=t(".m-create",e.root),r=moot.language,l="ontouchstart"in window&&screen.height<800&&/mobi/i.test(navigator.userAgent);if(e.is_sso&&!n.is_logged){var s=a.login_url?t("<a/>").click(function(){$(e)}):t("<div/>");return i.html(s.ac("sso-link").text(r.login_and+" "+r.start.toLowerCase()))}if(e.conf().show_title){i.append(O("create"));var c=t("textarea",i),u=c.eq(0).autogrow(),d=c.eq(1).autogrow(),m=t('[name="watch"]',i),p=t('[name="previewpost"]',i),f=window.getSelection,h=t("button",i);a.autowatch?m.parent().hide():m.prop("checked",a.autowatch_checked),l?i.ac("no-preview"):p.parent().hide(),p.on("change",function(){e.show_preview=this.checked,t('[name="previewpost"]').prop("checked",this.checked),t(".m-create, .m-replyform").tc("no-preview",!this.checked)}),n.on("login logout",!0,function(){h.text(n.is_logged?r.post:r.login_and+" "+r.post.toLowerCase())}),c.on("focus away drag",function(t){var o="f"==t.type[0],n=!!u.val();n||(u.attr("placeholder",r[o?"title":e.is_threaded?"comment":"start"]),d.attr("placeholder",o?r.body:"")),i.tc("focused",o||n||!!d.val())}).trigger("away"),Z(i,e),u.keydown(function(e){if(!(""+(f&&f()))){var o=e.which;if(Y)return 13!=o&&0;if(e.metaKey||e.ctrlKey)86==e.which&&setTimeout(function(){var e=t.trim(u.val()).split("\n"),o=e[0];o.length>80&&(e[1]=o.slice(80),o=o.slice(0,80),u.val(o).keyup().keydown(),d.val(e.slice(1).join("\n")+d.val()),d.keyup().keydown())},50);else{var n=this.value.length;if(13==o||n==this.selectionStart&&39==o||40==o)return d.focus(),!1;8!=o&&39!=o&&n>=80&&d.focus()}}}),d.keydown(function(e){if(!(""+(f&&f()))){var t=e.which,o=this.selectionStart;return 1==this.value.substr(0,o).split("\n").length&&o<100&&38==t||(37==t||8==t)&&!o?(u.focus(),!1):void 0}});var g=t(".m-select",i);g.parent().toggle(e.is_forum),e.on("categories",e.is_forum,function(){g.empty();var o=e.categories||[];o=t.grep(o,function(o){var n=o.path.replace(e.path,"");return!(!n||"/"==n||"/feed"==n)&&(g.append(t("<option/>",{value:o.path,text:o.title})),!0)}),g.parent().toggle(o.length>1)}).on("before:load",function(e){/all|feed/.test(e.type)&&g[0]?g[0].selectedIndex=0:g.val(e.path)}),h.click(function(a){if(a.preventDefault(),w(),n.is_logged){var i=t.trim(d.val());o={path:g.val(),title:u.val(),body:i,is_followed:m.is(":checked")};var r=oe(i);if(r[0]&&(o.files=r),e.is_forum&&"page"==e.page.type&&o.path!=e.page.path)return e.load(o.path,function(){h.click()});h.prop("disabled",!0),e.recaptcha?(console.log("grecaptcha executed..."),e.recaptcha.callback=_,grecaptcha.execute()):_()}})}function v(o,n){t(".m-created",e.root).remove(),u.val(o.title).focus(),d.val(o.body);var a="duplicate"==n.message?"Duplicate title":n.message?r.no_title:r.error;i.prepend(t("<div/>").ac("err tooltip").text(a)),o.error=n,e.log("error create:failed",o),c.one("keyup",w)}function w(){h.prop("disabled",!1),t(".m-tooltip",i).remove()}function _(t){try{t&&(o.recaptcha_token=t),e.create(o,function(){c.val("").trigger("away").blur(),w(),d.keydown()}).fail(function(e){v(o,e)})}catch(e){v(o,e)}}});var G=[16,27,33,34,35,36,37,38,39,40,45,91];function Z(e,o){var n=t("textarea",e),a=n.eq(0),i=n.last();moot.language;n.placeholder2("m-").keydown(function(o){var n=o.which;if(27==n)return a.trigger("away").blur();13==n&&(o.ctrlKey||o.metaKey)&&(o.preventDefault(),t("button",e).click())}).focus(function(){t(document).one("mousedown",function(o){t(o.target).closest(e)[0]||a.trigger("away")})}).keypress(function(t){String.fromCharCode(t.which)&&o.user.type(a.val()+i.val(),e.closest(".m-moot").data("moot"))}),i.keydown(function(e){var t=e.which,o=this,n=o.selectionStart,a=o.value;9!=t||!n||e.ctrlKey||e.shiftKey||(e.preventDefault(),o.value=a.slice(0,n)+"   "+a.slice(o.selectionEnd),o.focus(),o.selectionEnd=n+3),86==e.which&&(e.ctrlKey||e.metaKey)&&setTimeout(function(){i.keyup().keydown()},50)});var r=t(".m-help",e).active2({body_class:!1,prefix:"m-",trigger:t(".m-show-help",e)},function(){if(!n[1]){var e=r.outerHeight()<a.offset().top-t(window).scrollTop();r.css({top:e?-r.outerHeight()-10:""}).tc("above",e)}});!localStorage["moot.tip"]&&t(window).width()>800&&a.one("click",function(){r.trigger("open"),localStorage.setItem("moot.tip",1)}),a.trigger("away"),function(e,o,n,a){var i=e.hc("create"),r=t(O("preview")).appendTo(e).ac(i?"seed":"reply"),l=t(".m-title",r),s=t(".m-body",r),c=t(".m-name",r),u=moot.language,d=a.user,f=s.parent(),h=s.next().html("&hellip;");d.on("reload login logout",!0,function(e){t(".m-face",r).attr("src",d.img),c.text(d.displayname),c.next(".m-mod-badge").remove(),d.is_moderator&&c.after(t("<span/>",{text:u.admin}).ac("mod-badge"))}),o.add(n).keyup(function(){e.tc("filled",!!t(this).val())}),a.conf().show_title&&i&&(l.text(u.untitled),o.keyup(function(e){if(-1==t.inArray(e.which,G)){var o=m(k(p(moot.fixTitle(this.value),!1)));l.html(o||u.untitled)}}));n.keyup(function(e){if(-1==t.inArray(e.which,G)){var o=t(this).val(),n=f.hc("opened"),i=moot.fixBody(o,!n),r=!!i[1]||n;s.html(moot.format(i.slice(0,n?2:1))),a.emit("format",s,{uploads:oe(i.join(""))}),f.tc("expandable",r)}}),o.add(n).keydown(function(e){if(86==e.which&&(e.ctrlKey||e.metaKey)){var o=t(this);setTimeout(function(){o.trigger("keyup")},10)}}),h.click(function(){f.tc("closed opened"),h.html((f.hc("opened")?u.less:"")+"&hellip;"),n.triggerHandler("keyup")}),o.on("away",function(){o.add(n).trigger("keyup")})}(e,a,i,o),function(e,o,n){!1===n.conf().upload&&(te=!1);if(!te)return;var a=moot.language,i=t("<input/>",{type:"file",multiple:"multiple",accept:"image/*"}).css({visibility:"hidden"}).appendTo(e),r=t("<a/>",{title:a.upload}).ac("post-upload").append("<em>U</em>"),l=t(".m-imgtip",e);function s(r){r.preventDefault();var s=r.target.files||r.originalEvent.dataTransfer.files||[];t.each(s,function(r,c){var u=/image/.test(c.type),d=c.size<4e6;if(u&&d){l.hide();var m=new FileReader;n.emit("beforeupload",m),t(window).on("beforeunload.jees",function(){return"Image upload is in progress."}),m.onload=function(e){t(window).off("beforeunload.jees");var n=c.name.replace(/[^\w\.]/g,"").toLowerCase();if(n.length>=50){var a=n.lastIndexOf("."),l=n.substr(a),u=n.substr(0,a).substr(0,50-l.length);n=u+l}var d=c.name.split("."),m=d[0],p=ee[n];if(c.altname=n,c.data=e.target.result,p&&p.data!=c.data&&(m=d[0]+"-"+r,n="file_"+r+n,c.altname=n),m=H(m),o[0].value+=" ["+m[0].toUpperCase()+m.slice(1)+"]("+n+")",ee[n]=c,r==s.length-1){var f=t.trim(o.val())+" ";o.keyup().focus().val("").val(f)}i.val("")},m.readAsDataURL(c)}else l[0]||(l=t("<div/>").ac("tooltip imgtip").prependTo(e)),l.show().text(u?a.max:a.img_needed)})}r.prependTo(t(".m-controls",e)).tooltip2({prefix:"m-",position:"topleft"}),i.change(s),r.click(function(){i.click()}),e.on("drop",s).on("dragover dragleave drop",function(t){t.preventDefault(),e.tc("dragged",/over/.test(t.type))})}(e,i,o)}moot(function(e){e.channel.on("online offline",function(o){t("button, textarea",e.root).prop("disabled","offline"==o)})}),moot("topic",function(e){var o,n,a=t(".m-form",e.root),i=t("textarea",a).autogrow(),r=t('[name="watch"]',a).prop("checked",e.is_followed),l=t("button",a),s=moot.language,c=e.app,u=c.user,d=c.conf(),m=t('[name="previewpost"]',a),p=c.is_commenting?s.post:s.replybtn,f="ontouchstart"in window&&screen.height<800&&/mobi/i.test(navigator.userAgent);if(d.autowatch&&r.parent().hide(),f?a.ac("no-preview"):m.parent().hide(),c.show_preview&&(a.rc("no-preview"),m.prop("checked",!0)),m.on("change",function(){c.show_preview=this.checked,t('[name="previewpost"]').prop("checked",this.checked),t(".m-create, .m-replyform").tc("no-preview",!this.checked)}),u.on("login logout",!0,function(){l.text((u.is_logged?"":s.login_and+" ")+p)}),c.is_sso&&!u.is_logged){a.html("<div class='m-writing'/>");var h=d.login_url?t("<a/>").click(function(){$(c,e)}):t("<div/>");return a.append(h.html(p+"&hellip;").ac("sso-link"))}function g(n,r){t(".m-created",e.root).remove(),i.val(o).focus(),a.prepend(t("<div/>").ac("err tooltip").text(r||s.error))}function v(o){try{o&&(n.recaptcha_token=o),e.reply(n,function(){t(":file",a).val(""),l.prop("disabled",!1)}).fail(g)}catch(e){g(0,"Duplicate post :("),i.one("keydown",function(){l.prop("disabled",!1),t(".m-err",a).remove()})}}Z(a,c),i.on("focus away",function(e){a.tc("focused","f"==e.type[0]||!!i.val())}),e.seed.is_stub&&(i.attr("placeholder",e.replies.length?s.comment:s.comment1),e.one("reply",function(){i.attr("placeholder",s.comment)})),l.click(function(e){e.preventDefault(),t(".m-imgtip",a).hide();var s=t.trim(i.val()),m={body:s,is_followed:d.autowatch||r.is(":checked")},p=oe(s);s&&u.is_logged&&(i.val("").trigger("away").trigger("keydown").blur(),p[0]&&(m.files=p),l.prop("disabled",!0),n=m,o=s,c.recaptcha?(console.log("grecaptcha executed..."),c.recaptcha.callback=v,grecaptcha.execute()):v())})});var V,ee={},te="FormData"in window&&"File"in window;function oe(e){var t=[];return te&&e&&e.replace(E,function(e,o,n){var a=ee[n];a&&t.push(a)}),t}moot("load",function(){ee={}}),moot(function(e){var o,n=e.analytics&&e.analytics.ga;function a(i,r){if(!window.ga){if(o)return;return o=!0,t.getScript("//google-analytics.com/analytics.js",function(){ga("create",n,"auto"),a(i,r)})}ga("create",n,"auto"),ga("send","event","Moot: "+i,r,e.user.path||"anonymous")}n&&(e.user.on("login",function(){setTimeout(function(){a("login",e.page.path)},10)}),e.on("before:load",function(e){e.one("load",function(){a("load",e.title),"moot"==e.type&&a("topic",e.title)}),e.on("before:thread",function(e){a("post",e.seed.title)}).on("moot",function(e){e.on("load before:reply like",function(t){"load"==t&&(t="topic"),"before:reply"==t&&(t="post"),a(t,e.seed.title)})})}))}),moot(function(e){var o=e.conf();if(!o.widget&&!1!==o.update_title&&e.is_forum){V||(V=document.title||t("title").text()||"");var n=e.is_forum,a=(e.user,1e3*Q);e.channel.on("moot reply",function(e,t){t.seed&&(t=t.seed),t.path&&i(t.user," – "+(t.title||t.body[0]).slice(0,32))}).on("type",function(e){i(e,moot.language.writing)}),n&&e.on("load",function(e){e.title&&(document.title=e.title+" | "+V)})}function i(e,t){document.title=e.displayname+" "+t,setTimeout(function(){document.title=V},a)}});var ne=".m-image, .m-youtube-link, .m-youtu-link, .m-vimeo-link";moot(function(e){var o;t(".m-page",e.root).on("click",ne,function(e){e.preventDefault();var n=t(e.target).closest("a");if(!n.hc("vimeo-link")||parseInt(n.attr("href").split("/")[3])){e.preventDefault();var a=t("#m-gallery");a[0]||(a=t(O("gallery")).appendTo("body")),o||(o=a.active2("m-"));var i=t("#m-navi",a).empty(),r=t("#m-media"),l=t("iframe",r),s=t("img",r),c=t(ne,n.closest(".m-body"));n.closest(".m-moot");return c=c.filter(function(){var e,o,n=t(this),a=n.text(),c=t("<span/>").appendTo(i).html("<em>"+a+"</em>"),u=n.attr("href");if(/youtu/.test(n.attr("class"))){o=(u.split("?v=")[1]||u.split("/").slice(-1)[0]).split(/[&#]/)[0],e="//www.youtube.com/embed/"+o+"?autoplay=1";var d=/[#&]t=([^&$]+)/.exec(u);d&&(e+="&start="+d[1]),u="//i1.ytimg.com/vi/"+o+"/mqdefault.jpg"}else if(n.hc("vimeo-link")){if(o=u.split("/").slice(-1)[0],!parseInt(o))return!1;e="//player.vimeo.com/video/"+o+"?autoplay=1",t.getJSON("//vimeo.com/api/v2/video/"+o+".json?callback=?",function(e){u=e[0].thumbnail_small,c.css("backgroundImage","url("+u+")").attr("src",u)}),u=""}return ee[u]&&(u=ee[u].data),c.css("backgroundImage","url("+u+")").click(function(){t("span",i).rc("active"),t(this).ac("active"),l.attr("src",""),r.tc("is-video",!!e),t("div",r).text(a.length>10?a:""),e?(l[0]||(l=t("<iframe/>",{webkitAllowFullScreen:!0,mozallowfullscreen:!0,allowFullScreen:!0,frameborder:0,height:390,width:640}).appendTo(r)),l.attr("src",e)):s.attr("src",u)}),e&&c.ac("video"),!0}),a.tc("has-nav",c.length>1),window!=window.parent&&a.one("open",function(){var e=t(window),o=(t(document),300),i=e.outerHeight()-n.offset().top-o-100;i<0&&(o-=i),a.ac("on-iframe").css({paddingTop:n.offset().top-o})}),a.one("close",function(){l.attr("src",""),s.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")}).on("click.out",function(e){e.target!=a[0]&&e.target!=r[0]||a.trigger("close").off(".out")}),t("span",i).eq(c.index(n)).click(),a.trigger("open"),!1}})}),moot(function(e){var o,n,a=e.root,i=t(O("growl")).appendTo(a),r=i.eq(0),l=i.eq(1),s=t(".m-entries",i);e.messaging_enabled||i.tc("growl-standalone",!0),t(".m-destroy",i).click(function(){s.empty(),i.hide(),o=!0}),l.click(function(){i.show(),l.hide(),o=!1}),e.channel.on("moot reply",function(a,i){if(i){i.seed&&(i=i.seed);var c=e.page,u=c.find(i.path);if(!u||"moot"!=c.type&&!t(".m-focus",u.moot.root||1)[0]){var d=i.title||i.body&&i.body[0];(d=d.replace(D,function(e){return e.split("/").slice(-1)}).replace(E,function(e,t){return t})).length>=90&&(d=d.slice(0,90).slice(0,d.lastIndexOf(" "))+"&hellip;"),d=m(k(p(d)));var f={time:t.now(),user:i.user||i,title:d,path:i.path,moot:i.moot};f.user.displayname=H(f.user.displayname);var h=t(O("event",f)).prependTo(s);t(".m-link",h).click(function(){var t=c.find(f.path),o=t?t.seed?t:t.moot:c.find(f.moot.path);function n(){o.is_expanded||o.viewToggleExpand(!0),setTimeout(function(){(t=o.find(f.path))&&K(t.root)},400)}o?o.is_loaded?o.is_expanded?o.is_expanded&&K(t.root):n():o.load(n):e.load(f.moot.path,function(e){K(e[0].replies.slice(-1)[0].root)})}),o?l.show().mootboost(200):(l.hide(),r.show().mootboost(200),clearInterval(n),n=setTimeout(function(){r.hide(),l.show()},1e3*Q),r.one("mouseenter",function(){clearInterval(n)})),t(".m-entry",r).length>3&&r.ac("large")}}}).on("remove",function(e){t("[data-path='"+e.path+"']",r).remove(),t(".m-event",s)[0]||i.hide()})}),moot(function(e,o){var n=e.root,a=t("#moot-logo",n),i=t("a",a);if(e.has_products)return t(".m-slogan",a).remove(),i.attr("title",(e.is_forum?"Forums":"Commenting")+" by Muut").tooltip2({prefix:"m-"});var r,l,s,c=/^[a-zA-Z0-9\-]+$/,u=t(O("start",{name:e.name})).appendTo(n),d=t(".m-tooltip",u),m=t("form",u),p=t("input",m),f=t("button",m);function h(){u.rc("active"),t(document).off("click.m-logo")}function g(e){f.prop("disabled",!0),d.ac("active").html(e)}i.mouseover(function(){var e=i.offset();l=setTimeout(function(){u.ac("active").css({top:e.top-u.outerHeight()-26,left:e.left-u.outerWidth()/2+i.outerWidth()/2}),t(document).on("click.m-logo",function(e){t(e.target).closest(u)[0]||h()})},150)}).mouseout(function(e){t(e.originalEvent.relatedTarget).closest("#mt-start")[0]||clearTimeout(l)}),p.on("focus blur",function(e){r="focus"==e.type}),u.mouseleave(function(){r||h()}),p.keyup(function(e){if(13!=e.which){var o=t.trim(this.value);!o||c.test(o)?o&&d.rc("active"):g("Use numbers, letters or dashes")}}).one("keypress",function(){d.rc("active")}).keyup(function(){var e=t.trim(this.value);e.length>4&&s!=e&&c.test(e)&&(s=e,f.prop("disabled",!0),o.call("forumAvailable",e,function(){f.prop("disabled",!1),d.rc("active")}).fail(function(t){/taken/.test(t)?g('"'+e+'" is already reserved'):g('"'+e+'" is not available, please contact <em>info@muut.com</em>')}).always(function(){s=0}))}),m.submit(function(t){t.preventDefault();var o=this.name.value.toLowerCase(),n=o.length;if(!c.test(o)||n<5)return g("Type 5 characters or more");z("https://muut.com/"+o+"/?source="+e.name,900,800),h()}),t(".m-upgrade",n).click(function(e){window.open("https://muut.com/pricing/","_blank"),e.preventDefault()})}),moot(function(e){var o=e.root,n=t(".m-nav-online",o),a=t(".m-users",o),i=moot.language;function r(o){t("a.m-facelink",o.jquery?o:void 0).each(function(){var o=t(this).data("href")||t(this).attr("href");t(this).tc("online",!!e.getUser(o.slice(3)))})}if(e.on("post",function(e){r(e.root)}),e.channel.on("enter leave",r),e.user.on("login logout",r),!1===e.conf().show_online)return n.remove();a[0]||(a=t(O("online")).appendTo(t(".m-sidebar",o))),a.active2({prefix:"m-",trigger:n},function(e,t){var o=t.offset();e.offset({top:o.top+t.outerHeight()+10,left:o.left-a.outerWidth()+t.outerWidth()-10})});var l=t(".m-logged-users",a).empty(),s=t(".m-users-title em",a).add(t(".m-nav-online em",e.root)),c=t(".m-anon-count",a);function u(e){return t("[href*='"+e.path+"']",l)}function d(e){var o=u(e);return o[0]||(e.displayname=H(e.displayname),o=t(O("face",{user:e})).tooltip2({prefix:"m-"}).appendTo(l),e.is_admin&&(o.ac("is-admin"),t(".m-tooltip",o).append("<em> ("+i.admin+")</em>")),t("img",o).removeAttr("title")),o}l.on("click","a",function(){a.trigger("close")}),e.channel.on("enter",function(e){e&&d(e).mootboost(500)}).on("leave",function(e){e&&u(e).fadeOut(function(){t(this).remove()})}).on("away return",function(e,t){u(t).tc("inactive","away"==e)}).on("type",function(e){var o=t("<em/>").ac("typing").appendTo(e.path?u(e):c);setTimeout(function(){o.remove()},1e3*Q)}).on("enter leave away return",!0,function(t){var o=e.users.online_count||e.online.length,n=e.anon_count;"inline"!=t&&(/leave|away/.test(t)?o--:o++),e.users.online_count=o,l.add(s).toggle(o>0),s.text(o),c.toggle(n>0).html((o>0?"+":"")+"<em>"+n+"</em> "+i[1==n?"anon_1":"anon"])}),t.map(e.online,d)}),moot(function(e,o){e.on("load",function(n){t("#m-user-profile",e.root).remove();var a=e.page;if(a&&"user"==a.type){var i=a.meta.user;i.displayname=H(i.displayname),function(e,o,n){var a=86400,i=365*a,r=muut.language,l=t(O("profile",{user:e,forumname:o.name})),s=t("#m-profile-actions",l),c=t("#m-banned",l),u=t(".m-days",c),d=t(".m-cb",c),m=t(".m-msg",l).hide();if(e.path!=o.user.path&&((o.messaging||o.messaging_enabled)&&m.show().click(function(){m.ac("loading"),muut().messaging.launch(function(){muut().messaging.start(e.displayname+"<"+e.path.slice(1)+">"),m.rc("loading")})}),o.one("messaging-init",function(e){m.show(),o.messaging=e})),!o.user.is_moderator)return s.add(c).remove(),l;function p(t,a){o.user.is_moderator&&n.call("banUser",{username:e.path.slice(1),forumname:o.name,bantime:t},a)}function f(a,i,s){if(o.user.is_moderator){e["is_"+a]=i,l.tc("is-mod",i),t("#acl-badge span",l).text(r[a]);var c=e.path.slice(1);if(s)if("admin"==a){i?o.admins.push({username:c}):o.admins=o.admins.filter(function(e){return e.username!=c});var u=o.admins.map(function(e){return e.username});n.call("forumUpdate",{forumname:o.name,admins:u})}else n.call(i?"aclGrant":"aclRevoke",{forumname:o.name,usernames:[c],rights:[a],paths:["/"]},t.noop)}}function h(e){l.tc("is-banned",!!e),e&&(!0===e||e>i?t("input",d).prop("checked",!0).keydown():t("input",u).val(parseInt(e/a)).keydown())}t("input",c).on("keydown change mouseup",function(e){if(Number(this.value)>0)u.ac("active"),d.rc("active").find("input")[0].checked=!1;else{var o=this.checked;u.tc("active",!o),d.tc("active",o),o||t("input",u)[0].focus()}}).change(function(){var e=t("input",u),o=parseInt(e.val()),n=this.checked?10*i:o?a*(o+1):21*a;isNaN(o)&&e.val(21),n&&p(n)});var g=o.canUse("administrators",10,"sso"),v=o.canUse("moderators",20,"sso");return t(".m-mkadmin",s).toggle(g).click(function(){f("admin",!0,!0)}),t(".m-mkmod",s).toggle(v).click(function(){f("moderator",!0,!0)}),t("div",s).toggle(!v).find("span").text(g?r.upgrade_mod:r.upgrade_admin),t(".m-ban",s).click(function(){p(10*i),h(!0)}),t(".m-unban",c).click(function(){p(0),h(!1)}),t(".m-revoke",l).click(function(){f(e.is_admin?"admin":"moderator",!1,!0)}),f(e.is_admin?"admin":"moderator",!(!e.is_admin&&!e.is_moderator)),h(e.banTime),l}(i,e,o).insertAfter(t(".m-pagetitle",e.root))}})}),moot(function(e){var o,n,a,i=/^[^\<\>]{3,}$/i,r=t(O("share")).appendTo(e.root),l=t(document),s=e.conf();function c(e,t){r.tc("quotable",!!a).rc("behind"),e-=r.height();var o=r.width();t-=o-o/2,r.offset({top:e,left:t})}function u(){o&&o.rc("active"),r.ac("behind")}(e.skip_sharing||!1===s.share)&&t("#m-share-fb, #m-share-tw, #m-link").remove(),l.mouseup(function(i){var l=t(i.target);if(l.is(".m-menu")){n=!0,o=l;var u=l.closest(".m-post").data("post").path;t("#m-link",r).attr("href",s.prefix+u.replace("/"+e.name,"").replace("#",":"));var d=l.ac("active").offset();l.width();return c(d.top,d.left)}setTimeout(function(){var e=window.getSelection;a=e?e().toString():document.selection.createRange().text;try{if(e&&"P"!=e().getRangeAt(0).endContainer.parentNode.tagName)return}catch(e){}if(t.trim(a)&&!l.closest(".m-collapsed, a, .m-preview")[0]&&l.closest(".m-body-wrap, .m-title")[0])return n=!1,o=l,c(i.pageY-12,i.pageX+6)},10)}),e.on("format",function(e,o){t("blockquote",e).each(function(){var e=t(this),n=t("p:first",e),a=function(e,o,n){var a;if(i.test(e))return t(".m-facelink",n).filter(function(){var o=t(this),n=o.attr("href")||o.data("href");return n&&n.indexOf(e)>0||o.attr("title")==e}).each(function(){try{if((a=t(".m-body p:contains('"+o+"'):first",t(this).next()))[0])return!1}catch(e){}}),a}(n.text().slice(1),t("p:gt(0)",e).text(),o.moot?o.moot.root:e.closest(".m-moot"));a&&(n.ac("user-path"),e.ac("quote").on("mouseenter mouseleave click",function(e){"click"==e.type?K(a):t("body").is(":animated")||a.tc("boosted",/ee/.test(e.type))}))})}),l.mousedown(function(e){r&&!t(e.target).closest(r)[0]&&u()}),r.click(function(i){var r=t(i.target),l=o.closest(".m-post"),c=l.data("post"),d=c.user.displayname,m=s.page_url+s.prefix+c.relativePath.replace("#",":"),p=c.moot.seed.title;if(r.is("#m-share-fb")){var f=t(".m-image[href*='//']:first",l).attr("href")||t('[property="og:image"]:first').attr("content")||e.share_img||"";"//"==f.slice(0,2)&&(f="https:"+f);var h={app_id:"140164242702484",picture:f,name:p,description:n?c.body.join(" "):a,link:m,redirect_uri:"https://muut.com/sharing/",display:"popup"};z("https://www.facebook.com/dialog/feed?"+t.param(h),650,400)}else if(r.is("#m-share-tw")){n&&(a=p);var g=d.length;a.length+g+21>134&&(a=a.slice(0,134-g-22)+"…"),a='"'+a+'" –'+d;var v=e.twitter_handle;h={text:a,url:m};v&&(h.via=v),z("https://twitter.com/intent/tweet?"+t.param(h),550,420)}else if(!n){var w=t("textarea",o.closest(".m-moot")),_=w.val();_&&(_+="\n"),_+="> "+(s.quotes_with_displayname?"@"+d:c.user.path)+"\n",_+="> "+a+"\n",K(w,200,function(){w.val(_).keyup().keydown();var e=w[0];e.focus(),e.selectionStart=e.selectionEnd=e.value.length})}u()}),u()});var ae=/font-family:\s?['"]?([\w\s]+)['"]?;/,ie=t("<span/>",{text:"My F0n# T000 Str--ing"}),re=!!t.browser.msie&&t.browser.version<9;moot.css={accent:".m-heart.m-has-likes span, .moot .m-button::after, .moot .m-show-help",accentbg:".moot button, .m-button",body:".moot .m-body, .m-input-body",boxes:".m-moot, .m-sidebar",button:".moot .m-button, .moot button",collapsed:".m-moot.m-collapsed .m-title",create:".moot .m-input-wrap",face:".moot .m-face",header:".moot .m-header",headings:".moot .m-sidebar .m-h3, .m-pagetitle, .m-navi a",input:".m-focused .m-input-wrap, .m-focused.m-replyform textarea",moot:".moot",navi:".m-links",page:"body",para:".m-body p, .moot textarea",replies:".moot .m-replies",reply:".m-reply",selected:"#m-mainlinks .m-selected, .m-pagepage .m-nav-forums, .m-userpage .m-nav-online",sidebar:".m-sidebar",title:".moot .m-title, .moot textarea.m-input-title",topic:".moot .m-moot, .m-create .m-input-wrap, .m-preview",wrap:".m-wrap, .m-tablet"};var le={};moot.loadFont=function(e,o){if(le[e]||function(e){var t=ie.css({fontFamily:"'"+e+"'"}).appendTo("body").width();ie.css({fontFamily:"'"+e+"', monospace"});var o=t==ie.width();return ie.remove(),o}(e))return o&&o();var n;le[e]=!0,e=(n=e.replace(/ /g,"+"))&&n.replace(/["']/g,""),t('<link href="//fonts.googleapis.com/css?family='+e+"\" rel='stylesheet'>").appendTo("head").load(o)},moot(function(e){var o=e.root,n=(e.user.is_logged,e.design),a=t(window),i=(a.outerHeight(),"");o.rc("app-loading loading").tc("sso",e.is_sso).tc("no-title",!e.conf().show_title).tc("ie8",re).tc("webkit",!!t.browser.webkit||!!t.browser.chrome),e.on("load",function(t){o.tc("with-messaging",!!e.messaging),o.tc("no-threads",!t[0])});var r=e.brand_color;if(r&&e.canUse("color-and-logo",10,"branding")){r[3]||(r+=r);var l=parseInt(r,16)>8388607.5;i+=".m-dialog-head { background-color: #"+r+(l?";color: #333":"")+"}"}n&&(o.addClass(n.classes),t.each(n.css,function(e,t){if("page"!=e||/moot.it|muut.com/.test(location.host)){i+=moot.css[e]+"{"+t+"}";var o=ae.exec(t);o&&moot.loadFont(o[1])}}));var s=t("<style/>",{id:"moot-css"}).appendTo("head");re?s[0].styleSheet.cssText=i:s.text(i);var c=parseFloat(o.css("fontSize")),u=t(".m-wrap:eq(1)",o),d=0;function m(){var e=(u[0]||o[0]).clientWidth/c;if(d&&d<43&&e>=43){var n=t(".m-sidebar .m-forums-wrap"),a=t(".m-sidebar .m-users"),i=t("body");i.hasClass("m-overlaid")&&(n.hasClass("m-active")||a.hasClass("m-active"))&&i.removeClass("m-overlaid"),n.removeAttr("style").removeClass("m-active"),a.removeAttr("style").removeClass("m-active")}e>0&&o.tc("pc",e>=43).tc("tablet",e<43).tc("mobile",e<25),d=e}a.resize(m),m(),a.one("load",m),setTimeout(m,2700)}),muut.AUTH_URL="https://app.muut.com/account/auth",muut.changePassword=function(e){e.conf();var o=t.extend({lang:muut.language.$code},e.channel.session);muut.openWindow("https://app.muut.com/account/auth/../password/?"+t.param(o),780,600)},moot(function(e,o){var n=/.+@.+\..+/i,a=/^[^\<\>]{3,}$/,i=e.root,r=e.user,l=e.conf(),s=moot.language,c=t(".m-nav-account",i),u=t(O("account_overlay")).prependTo(i),d=t(".m-h2",u).text(r.displayname),m=t(".m-admin-area",i),p=t(".m-myname",c),f=t(".m-login",i),h=t(".m-me",c);function g(){window.open("https://muut.com/account/#"+e.name,"_blank")}e.is_sso&&l.login_url&&(r.is_logged?f.remove():f.click(function(){$(e)})),u.active2({prefix:"m-",trigger:h},function(){var e=h.offset();u.offset({left:e.left+(l.rtl?0:h.outerWidth()-u.outerWidth()),top:e.top+h.outerHeight()+10})}),t(".m-my-profile").click(function(){e.load(r.path),u.trigger("close")}),t(".m-status",u).each(function(){var e=t(this);function o(){var o=r.is_visible;t("em",e).text(s[o?"online":"invisible"]),t("a",e).text(s[o?"hide":"show"]),e.tc("invisible",!o)}t("a",e).click(function(){e.ac("loading"),r.hideToggle(function(){e.rc("loading"),o()})}),r.on("login logout",!0,o)}),t("#m-disable-notifications").each(function(){var e=t(this),o=t("input",e);r.on("login",!0,function(){var e=!!r.notifications_disabled;o.prop("checked",e)}),o.change(function(){var e=this.checked;r.toggleNotifications(e)})}),t("#m-follow").each(function(){var o=t(this),n=t("input",o);r.on("login",!0,function(){var t=r.subscription_paths;t=t&&t[0]==e.path,n.prop("checked",t),o.tc("follow-all",t)}),r.on("follow unfollow login",!0,function(){var e=r.subscription_count;t("#m-unfollow-all").toggle(e>0),t("em",o).text(e)}),t("a",o).click(function(){t(this);r.unfollowAll(function(){r.subscription_count=0,r.emit("unfollow")})}),n.change(function(){var t=this.checked;r.toggleFollow(e.path,t,function(){o.tc("follow-all",t)})})});var v=t(".m-upload",u),w=t("a",v),_=t("img",v),y=t(".m-preview img, img[title='"+r.displayname+"']",i).add(_),b=t(":file",v);w.click(function(e){e.preventDefault(),b.click()}),e.is_sso&&e.is_avatar_provided&&(w.hide(),w.click(function(){})),b.bind("change drop",function(o){t.each(o.target.files||[],function(t,o){if(o.type.match("image.*")&&o.size<35e5){var n=new FileReader;n.onload=function(t){y.attr("src",t.target.result),o.altname="img",e.user.update({img:o.name,files:[o]})},n.readAsDataURL(o)}})}),t("form",u).each(function(){var e=t(this),o=t("input",e),c=t("<button/>",{text:s.change,disabled:!0}).appendTo(e),u=o.attr("name");function m(){var e=t.trim(o.val()),i="email"==u?n:a;return e!=r[u]&&i.test(e)}o.keyup(function(t){var o=m();c.show().prop("disabled",!o),this.value==r[u]&&c.hide(),o&&e.rc("is-error")}),e.submit(function(n){if(!m())return!1;n.preventDefault(),e.ac("loading").rc("valid");var a={},f="email"==u,h=H(t.trim(o.val())),g=t(".m-name:contains('"+r.displayname+"')",i);a[u]=h,f&&(a.url=l.page_url),r.update(a,function(){if(e.rc("loading").ac("updated"),c.hide(),!f){var o=t("<span class='m-saved'>"+s.saved+"</span>").appendTo(e);setTimeout(function(){o.remove()},1e3),g.add(d).add(p).text(h)}}).fail(function(o){e.rc("loading").ac("is-error"),t(".m-error",e).text(/taken/.test(o)?s[u+"_taken"]:s.invalid)})})});var k=t(".m-maillist input").prop("checked",!!r.maillist).change(function(){r.update({maillist:!!this.checked},function(){k.parent().mootboost()})});t(".m-password",u).click(function(){muut.changePassword(e)}),r.login=function(o){t(".m-login",i).click(),e.one("reload",o)},t(".m-logout",i).click(function(){u.ac("loading"),r.logout()}),r.on("login",r.is_logged,function(){if(_.add(t("img",h)).attr("src",H(r.img)),p.add(d).text(r.displayname),t(".m-names strong",u).text(r.path),t.each(["displayname","email"],function(){t("[name='"+this+"']",u).val(r[this])}),k.prop("checked",!!r.maillist),i.tc("is-unverified",!!r.unverified),r.unverified&&!t(".m-unverified")[0]){var n=t(O("unverified",{email:r.email}));t(".m-page",i).prepend(n);var a=t("<a/>").ac("incomplete").html(s.unver3);t(".m-email .m-h3",u).append(t("<span/>").ac("badge").text(s.unver)).after(a),a.add(t("a",n)).click(function(){var o=t(this);r.sendValidationCode({forumname:e.name,url:l.page_url},function(){o.replaceWith(t("<strong/>").text(s.unver4).ac("incomplete"))})})}if(r.is_admin&&e.is_forum){var c=t(".m-sidebar",i),f=t(".m-forums-title",c);t(".m-edit-cats",c)[0]||t("<a/>",{text:s.edit}).ac("edit-cats").appendTo(f).click(function(){window.open("https://muut.com/settings/#"+e.name+"/channels","_blank").focus()}),m.html(O("admin",{name:e.name})),t(".m-nav-settings",m).click(function(){window.open("https://muut.com/settings/#"+e.name,"_blank").focus()}),t(".m-nav-designer",m).click(function(n){n.preventDefault();var a=t("body").toggleClass("md-enabled");t("#moot-designer")[0]||(t("head").append("<link href='https://cdn.muut.com/1.16.31/designer.css' rel='stylesheet'>"),t("<div/>",{id:"moot-designer"}).appendTo(a).load("https://cdn.muut.com/1.16.31/designer.html",function(){t.getScript("https://cdn.muut.com/1.16.31/designer.min.js",function(){moot.designer(e,o)})}))});var v=t("#m-plan",m),w=e.service||{},y=e.products,b=w.level,x=w.trial_left,T=r.is_owner&&x>0;if(x>0&&(b=30),T&&t("#m-trial-left").show().find(".m-badge").text(function(e){if(e>0){var t=e/86400;if(t>2)return Math.round(t)+" days";var o=e/3600;return o>2?Math.round(o)+" hours":Math.round(e/60)+" minutes"}}(x)),y[0]?(v.html(O("addons")),t.map(y,function(e){var o=e.split("-")[0];t(".m-"+o,v).ac("active")})):b&&t(".m-planlist em:lt("+((b-10)/10+1)+")",v).ac("active").last().ac("current"),w.is_io){(x>0||"io.trial"===w.type)&&(b=0),t(".m-plan-desc",v).prepend("IO ");var j=b?'<em class="m-active m-current">'+{10:"XS",20:"S",30:"M",40:"L"}[b]+"</em>":"";t(".m-planlist").html(j)}t(".m-upgrade",v).text("Upgrade now").off("click").click(g),setTimeout(function(){var e=!1;w.is_io||(e=r.is_owner&&(b||0)<30||!!T),t(".m-upgrade",v).toggle(e)},0);var C=localStorage,q=t(".m-yearly",m).toggle("monthly"==w.term&&!C.noyearly).click(g);t("em",q).click(function(){q.remove();try{C.noyearly=1}catch(e){}return!1}),t("#m-referred").toggle(!!r.referralEligible),t("#m-refer, .m-upgrade",m).toggle(!r.referralEligible)}r.is_moderator&&!r.is_admin&&e.is_forum&&m.html(O("mod"))}),r.on("login logout banned",!0,function(){var e=r.is_logged;i.tc("logged",e).tc("no-logged",!e),u.rc("loading").trigger("close"),i.tc("is-admin",r.is_admin).tc("is-moderator",r.is_moderator);var o=e&&r.banTime>0;i.tc("is-banned",o),o&&t(".m-page",i).prepend(O("banned"))}).on("logout",function(){t(".m-unverified, .m-ban-msg, .m-incomplete, .m-edit-cats, .m-email .m-badge",i).remove()}),e.is_sso&&t(".m-h3, form, .m-password, .m-maillist",u).remove()}),moot(function(e){var o,n=moot.language,a={password:["changepw",0,"change"],account:["c_acc","c_acc1"],expired:["expired"],email:["c_email"]};function i(){var i=(unescape(location.hash).split("!")[1]||"").split("/"),r=i[0],l=i[1],s=i[2];if(!o&&/password|account|email/.test(r)&&l){o=!0;var c=e.root,u=e.user,d={confcode:l,email:s},m=t(O("dialog")).active2({prefix:"m-dialog-"}),p=a[r],f=t(".m-dialog-title",m).text(n[p[0]]),h=t(".m-dialog-body",m).text(n[p[1]]),g=t("button:last",m).text(n[p[2]]||n.ok);if(m.trigger("open"),u.is_logged||(d.path=e.page.path),t("button, .m-dialog-close",m).click(function(){m.remove(),"localhost"!=location.hostname&&history.replaceState&&history.replaceState(null,null,"#")}),"password"==r)return!!u.is_logged||u.checkResetCode(d,function(){d.id=d.email,delete d.email,c.append(m),h.text(n.open_pw),g.click(function(){t.extend(d,{lang:n.$code},e.channel.session),z("https://app.muut.com/account/auth/reset/?"+t.param(d),780,600)})}).fail(w);if("account"==r||u.is_logged){var v="account"==r;u[v?"confirmAccount":"confirmEmail"](d,function(){c.append(m),v?(c.rc("is-unverified"),t(".m-unverified",c).remove()):(t(".m-email input",c).val(s),h.html(n.address_now))}).fail(w)}else c.append(m),f.text(n.login1),h.text(n.non_anon),g.text(n.login),g.click(function(){t(".m-login",c).click()});t(window).off("popstate.confirm")}function w(e){m.ac("alarm"),f.text(n.warning),h.text(n.expired),g.text(n.ok),c.append(m)}}t(window).on("popstate.confirm",i),setTimeout(i,t.browser.msie?500:0)}),moot(function(e){if(!e.is_sso){var o=window.localStorage||{},n=e.conf(),a=moot.language,i=e.user,r=e.root;t();r.on("click",".m-form button, .m-login, .m-like",function(r,l){var s,c;if(!e.user.is_logged)return s=l,c={referrer:o["moot.referrer"],expand_all:!n.show_title,path:e.page.path,lang:a.$code},s&&t.extend(c,s),t.extend(c,e.channel.session),(window.mootlogin||z)("https://app.muut.com/account/auth/login/?"+t.param(c),780,600),i.one("login join",function(){var e=t(r.target).click();if(e.is("button")){var o=e.closest(".m-post");if(!o[0]){var n=e.closest(".m-moot");n[0]&&(o=t(".m-replies .m-reply:last",n))}K(o)}}),!1})}}),t.fn.moot=t.fn.muut=function(e,o){return"string"==typeof e&&(e={url:e}),e=t.extend({show_title:!0,prefix:"#!",autowatch:!0,autowatch_checked:!0},e),muut.prefix=e.prefix,this.each(function(){var n,a=t(this),i=a.attr("href"),r=a.data(),l=location.hash.split(e.prefix)[1],s=r.channel||r.category||r.pagetitle||document.title||t("title").text()||"",c=moot.language,u=t("<span/>").text(c.loading).ac("loading-text");if(!a.data("ready")){a.data("ready",!0),i||(i=t(".muut-url",a).remove().attr("href")),t("*",a)[0]&&(n=a.html()),t.extend(e,r),e.url&&e.url.href&&(e.url=e.url.href);var d=(e=t.extend({quotes_with_displayname:!0},e,{mootTitle:e.title||a.attr("title"),channelName:s.slice(0,30*Q)||"Untitled",url:(i||e.url).toLowerCase(),page_url:e.page_url,rtl:"rtl"==t("html").attr("dir")})).url.split(e.prefix);if(d[1]&&(e.page_path=d[1],e.url=d[0]),e.channel&&(e.channelName=e.channel),l&&"/"==l[0]&&(e.path=unescape(l)),"dynamic"==a.attr("type")&&(e.url+=":"+location.pathname.slice(1).replace(/\//g,"-"),e.show_title=!1),a.is("a")){var m=t("<div/>").attr({class:a.attr("class"),"data-url":e.url});a.replaceWith(m),a=m}a.addClass("moot m-app-loading"),t("*",a)[0]||a.empty(),!1!==e.ui&&a.prepend(u);try{moot("error",function(e){"currentforum:invalid"==e&&a.html(c.badforum+': "'+this.name+'"')}),moot(e,function(e){e.html=n,e.root=a,t.isFunction(o)&&o.call(e,e),u.remove()})}catch(e){a.rc("app-loading"),/json-rpc/.test(e.message)&&a.ac("no-support").html(O("browser")).append('<img style="display:none" src="//oldbrowser.muut.com/'+escape(navigator.userAgent)+'">')}}})},t(function(){t(".moot[href], .muut[href]").moot(),t(".moot .moot-url[href], .muut .muut-url[href]").each(function(){var e=t(this);e.closest(".moot, .muut").moot(e.remove().attr("href"))})})}(this.top,jQuery),function(e){"use strict";function t(e,t){for(var o in t)e[o]=t[o];return e}function o(e,o){return t(t({},e),o)}function n(e,t,o){return'<span class="'+e+t+'">'+o+"</span>"}function a(e){return(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/&lt;mark&gt;/g,"<mark>").replace(/&lt;\/mark&gt;/g,"</mark>")}function i(t,i,l){var s,c,u="",d="";return i=i||"",l=l||"",t.split("\n").map(function(e,t){var m=e.trim(),p=m.slice(0,2),f="<"==m[0]||">"==m.slice(-1);if(!f&&("//"==p||"--"==p||"# "==p))return u+=n(l,"comment",a(e))+"\n";if("/*"!=p&&"{#"!=p&&"\x3c!--"!=m.slice(0,4)||(c=!0),c)return d+=e+"\n",void("*/"!=m.slice(-2)&&"#}"!=m.slice(-2)&&"--\x3e"!=m.slice(-3)||(c=!1,u+=n(l,"comment",a(d)),d=""));if(f){var h=m.toLowerCase().slice(1,6);"style"==h&&(s=!0),s&&"/styl"==h&&(s=!1)}u+=function(e,t,i){var l="",s=[],c=o(r.common,r[t]);for(var u in e=a(e),c){var d=c[u],m=u.split(",");d&&e.replace(d,function(){for(var e,t,o,n,a=0,i=m.length,r=arguments;e=m[a];a++)o=r[a+(t=i>1?1:0)],n=r[i+t],4!=r.length||t||(o=r[1]||r[0],n=r[2]),a&&(n+=[].slice.call(r,1,a+1).join("").length),s.push([n,n+o.length,e])})}var p,f,h=0,g=0,v=0;for((s=s.sort(function(e,t){return e[0]-t[0]})).length;p=s[g];g++)s[g-1],f=s[g+1]||[],p[0]<v||p[0]==f[0]&&f[1]>p[1]||p[1]>v&&(v=p[1],l+=e.substring(h,p[0]),l+=n(i,p[2],e.substring(p[0],p[1])),h=p[1]);return l+=e.substring(h)}(e,f?"html":s?"css":i,l)+"\n"}),u=u.trim(),e?u:'<pre class="'+l+"syntax "+l+i+'">'+u+"</pre>"}var r={common:{string:/'[^']*'|"[^"]*"/g,keyword:/\b(none|true|false|and|array|catch|class|def|delete|echo|end|else|elseif|exit|extends|except|finally|for|foreach|global|if|import|local|module|new|object|or|package|print|private|protected|public|rescue|return|require|self|struct|static|sub|switch|then|this|throw|try|unsigned|var|while)\b/gi,accent1:/\b(boolean|const|void|char|short|int|integer|long|float|double|string)\b/g,operator:/\+|\!|%|\-|&lt;|&gt;|&amp;|\.|;|:|\||\*|\=/g,bracket:/[{}\[\]\(\)]/g,number:/\b\d+\.?\d*\b/gi,"accent2,bracket":/\b(\w+)\s?(\()/gi},html:{operator:0,accent1:0,accent2:0,"accent2,bracket":0,"bracket,accent1":/(&lt;\/?)([\w-]+)/g,"accent2,operator":/([\w-]+)(=)/g,bracket:/&lt;|&gt;/g,accent3:/{[^}]+}/g},java:{accent3:/@\w+\b/gi},js:{accent1:/\$|function|window|document|setTimeout|setInterval|console/g,accent3:/\/.+\/[igm]{0,3}/g},css:{keyword:/body|html|none|inline|bold|block|rgba?|hsla?|solid|dotted|italic/gi,"number,number":/(\d+\.*\d*)(px|em|rem|%)/gi,string:/#[a-f0-9]{3,6}/gi,accent1:/\b([\-\w]+):\s?/gi,accent2:/[#\.][\w\-]+\b/gi,accent3:/:\w+/gi},python:{accent3:/"""[\w\W]*"""/gm},ruby:{accent1:/\b(String|ArgumentError|puts|Thread|Errno::|Exception)\b/g,accent3:/[@:]\w+/g},markdown:{keyword:/[\*_].+[\*_]/gi,accent1:/#{1,2} .+/g,accent2:/#{3,} .+/g,accent3:/[- =]{3,}/g},sh:{accent1:/\b(echo|rm|ls|mkdir|rmdir|cd|find|cp|exit|pwd|exec|set|sed|awk)\b/g},php:{accent3:/\$\w+\b/g},perl:{"keyword,accent3":/\b(sub)\s*(\w+)\s*{/g},sql:{accent1:/\b(insert|into|create|table|update|select|from|where|values)\b/gi},redis:{accent1:/[A-Z]+/g}};r.javascript=r.js,r.stylus=r.css,r.yaml=r.markdown,r.shell=r.bash=r.sh,r.coffee=r.coffeescript=o(r.python,{accent1:r.js.accent1,accent2:/-&gt;/g}),r.django=r.jinja=o(r.html,{bracket:r.common.bracket,keyword:/\b(set|block|endblock|extends|if|endif)\b/g,accent3:/(\{\{.+\}\})/g}),i.lang=r,e?module.exports=i:window.hilite2=i}("object"==typeof exports),moot.language={$code:"en",no_notify:"Disable all email notifications",watchall:"Watch for all new threads",move:"Move thread",moved:"Thread moved",custom_path1:"Custom path",custom_path:"Enter custom path",invalid_path:"Invalid custom path",from:"From",to:"To",show_preview:"Show preview",retire:"Retire",retire_title:"Retire thread",retire_desc:"Retired threads no longer get bumped to top in the feeds they appear in.",retired_desc:"This thread is retired. New replies no longer bump it to the top of the feed.",is_retired:"This thread has been retired",unretire:"Unretire",unretire_title:"Unretire thread",unretire_desc:"This thread will be bumped to top in the feeds they appear in.",quote_help1:"Select",quote_help2:"to quote or share",trial_left:"left of free trial.",after_trial:"After the trial ends you can continue using Muut with the",free_plan:"Free plan",reward:"Referral reward",off33:"Upgrade now and get 33% off all our paid plans!",spread:"Spread the word!",invite:"Invite a friend to start a Muut community and you’ll both get rewarded!",start_now:"Start your own community now – it's free!",start_btn:"Create",reserve:"Reserve your forum name",free_acc:"Free account",no_dialog:"and remove this dialogue",click_change:"Click to change",moderator:"Moderator",mkadmin:"Make administrator",mkmod:"Make moderator",upgrade_mod:"to make this user a moderator",upgrade_admin:"to make this user administrator or moderator",my_profile:"My profile",post_in:"Post in",address_now:"Thank you! Your email address has been confirmed.",open_pw:"Please hit the button below to open a password change dialog",non_anon:"You need to be logged in to perform this action",plan:"Plan",trial:"Start free trial",is_private:"This community is private",owner_msg:"Your message to the forum owner... (Optional)",req_access:"Request access",req_sent:"Access request sent",or_join:"or <a>Join</a> to access the community.",save_with:"Save 20% with yearly billing",rem_post:"Remove this post?",is_spam:"This post is spam?",channels:"Channels",ch_name:"Channel name",ban:"Ban user",banned:"Banned",ban_acc:"Banned account",ban_msg:"You are temporarily banned from posting on this forum.",days:"Days",forever:"Forever",slogan:"Free forums and commenting by Muut",add:"+ Add",addons:"Add-ons",myaccount:"Account",untitled:"Untitled",design:"Design",no_title:"Title must be given",designer:"Designer",developer:"Developer",warning:"Warning",profanity:"Profanity is not allowed on this forum. Continued abuse of this policy will result in being banned.",img_needed:"Please upload an image file",max:"Maximum image size is 4Mb",yes:"Yes",upload:"Upload images",show:"show",hide:"hide",invisible:"Invisible",givebody:"Body cannot be empty.",show_old:"Show oldest replies",show_more:"Show more replies",show_new:"Show newest replies",start:"Start a new topic...",error:"Oops, an error. Please copy the post to clipboard, reload and try again. Sorry – we will fix this!",body:"Body text",admin:"Admin",someone:"Someone",title:"Title",writing:"is writing...",manage:"Manage",fullview:"Full view",link:"link",avatar:"Change avatar",upgrade_link:"Upgrade",branding:"Branding",logo:"Logo",title:"Title",css:"CSS file",single:"single word",username_fail:"Use letters, numbers or dashes",bold:"bold",italics:"italics",monospaced:"monospaced",settings:"Settings",all:"All posts",anon_1:"anonymous",anon:"anonymous",badforum:"Invalid forum",c_acc1:"Your account now works on all sites using Muut",c_acc:"Account confirmed",c_email:"Email address updated",cancel:"Cancel",change:"Change",changepw:"Change password",close:"Close",collapse:"Collapse all",comm_count_1:"comment",comm_count_n:"comments",comment1:"Be the first to comment...",comment:"Comment...",edit:"Edit",email:"Email",email_taken:"This email is taken",emailtip:"Your email is never shared",enter:"ctrl + enter",expired1:"We just sent you a new one. Please check your email.",expired:"This link has expired",feed:"My feed",help2:"post",help3:"quoted",help5:"code, language guessed",help6:"HTML code",in_forum:"in",invalid:"Invalid value",join:"Join Muut",later:"Later...",less:"less",like:"Like",likepost:"Like this post",loading:"Loading...",login:"Log in",login1:"Log in first",login_and:"Login and",logout:"Log out",mark:"Offensive or spam",mean:"Did you mean",name:"Display name",nametip:"Your real name, so people will recognize you",newpass:"New password",noresults:"No results for",nospam:"No spam on your forum!",notexist:"does not exist.",ok:"ok",online:"Online",post:"Post",preview:"Preview",progress:["loading...","still working...","and working...","giving up"],reconnect:"Reconnecting...",removepost:"Remove",reply:"Reply...",replybtn:"Reply",saved:"saved",search:"Search",select:"Select channel",setup:"Setup now",showing:"Showing",spam:"Spam",step1:"We have sent you a confirmation email. Your email is not updated before you complete this step!",step:"One more step",terms:"I agree to the <a>terms of service</a>.",thanks:"Thanks!",uname_len:"Type 4 characters or more",uname_taken:"This username is taken!",unametip:"This cannot be changed later",undo:"Undo",unlike:"Unlike",unspam:"Not spam",unver1:"Unverified account",unver2:"Please check your email to verify your account.",unver3:"Resend verification link",unver4:"Sent. Please check your inbox.",unver:"Unverified",unwall:"unwatch all",unwatch:"Unwatch",upgrade2:"Muut uses WebSockets or CORS for cross domain communication. All modern browsers above Opera 11 and IE7 work.",upgrade:"Please upgrade your browser",username_taken:"This username is taken",watch:"Watch for new replies",welcome1:"Please check your email to complete the registration. If you dont receive email within a minute or two, check your spam folder.",welcome2:"Please provide a Muut username",welcome:"Welcome to Muut",you:"You",now:"just now",months:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",min:"m",hour:"h",day:"d",week:"w"};})}(document);